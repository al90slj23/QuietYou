<div class="page-shop-list">
  <!-- ç»Ÿè®¡å¡ç‰‡ -->
  <div class="stat-cards" style="grid-template-columns: repeat(4, 1fr);">
    <div class="stat-card">
      <div class="stat-card-title">æ€»å•†å®¶æ•°</div>
      <div class="stat-card-value">52</div>
    </div>
    <div class="stat-card">
      <div class="stat-card-title">å¾…å®¡æ ¸</div>
      <div class="stat-card-value" style="color:var(--warning-color)">2</div>
    </div>
    <div class="stat-card">
      <div class="stat-card-title">å·²è®¤è¯</div>
      <div class="stat-card-value" style="color:var(--success-color)">48</div>
    </div>
    <div class="stat-card">
      <div class="stat-card-title">å·²åœç”¨</div>
      <div class="stat-card-value" style="color:var(--error-color)">2</div>
    </div>
  </div>

  <!-- ç­›é€‰æ  -->
  <div class="card">
    <div class="filter-bar">
      <input type="text" class="filter-input" placeholder="æœç´¢å•†å®¶ID/åç§°/è”ç³»äºº" id="searchInput">
      <select class="filter-select" id="verifyFilter">
        <option value="">è®¤è¯çŠ¶æ€</option>
        <option value="0">å¾…å®¡æ ¸</option>
        <option value="1">å·²è®¤è¯</option>
        <option value="2">å·²åœç”¨</option>
      </select>
      <button class="btn btn-primary" onclick="searchShops()">æœç´¢</button>
      <button class="btn btn-default" onclick="resetFilters()">é‡ç½®</button>
    </div>
  </div>

  <!-- å•†å®¶åˆ—è¡¨ -->
  <div class="card">
    <div class="card-title">
      <span>å•†å®¶åˆ—è¡¨</span>
      <button class="btn btn-primary" onclick="ADMIN.navigateTo('shop/pending')">å¾…å®¡æ ¸ (2)</button>
    </div>
    <table class="data-table">
      <thead>
        <tr>
          <th>å•†å®¶ID</th>
          <th>Logo</th>
          <th>å•†å®¶åç§°</th>
          <th>è”ç³»äºº</th>
          <th>è”ç³»ç”µè¯</th>
          <th>æŠ€å¸ˆæ•°</th>
          <th>è®¢å•æ•°</th>
          <th>ä½£é‡‘æ¯”ä¾‹</th>
          <th>çŠ¶æ€</th>
          <th>æ“ä½œ</th>
        </tr>
      </thead>
      <tbody id="shopTableBody">
        <!-- åŠ¨æ€ç”Ÿæˆ -->
      </tbody>
    </table>
    
    <div class="pagination" id="pagination">
      <!-- åŠ¨æ€ç”Ÿæˆ -->
    </div>
  </div>
</div>

<!-- å•†å®¶è¯¦æƒ…å¼¹çª— -->
<div class="modal-overlay" id="shopDetailModal" style="display:none">
  <div class="modal" style="min-width:700px">
    <div class="modal-header">
      <span class="modal-title">å•†å®¶è¯¦æƒ…</span>
      <span class="modal-close" onclick="closeShopDetail()">Ã—</span>
    </div>
    <div class="modal-body" id="shopDetailContent">
      <!-- åŠ¨æ€ç”Ÿæˆ -->
    </div>
    <div class="modal-footer">
      <button class="btn btn-default" onclick="closeShopDetail()">å…³é—­</button>
    </div>
  </div>
</div>

<!-- ä½£é‡‘è®¾ç½®å¼¹çª— -->
<div class="modal-overlay" id="commissionModal" style="display:none">
  <div class="modal" style="min-width:400px">
    <div class="modal-header">
      <span class="modal-title">è®¾ç½®ä½£é‡‘æ¯”ä¾‹</span>
      <span class="modal-close" onclick="closeCommissionModal()">Ã—</span>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label class="form-label">å•†å®¶åç§°</label>
        <input type="text" class="form-control" id="commissionShopName" readonly>
      </div>
      <div class="form-group">
        <label class="form-label required">å¹³å°ä½£é‡‘æ¯”ä¾‹ (%)</label>
        <input type="number" class="form-control" id="commissionRate" min="0" max="100" step="0.1">
        <div style="font-size:12px;color:var(--text-secondary);margin-top:4px;">
          å½“å‰é»˜è®¤æ¯”ä¾‹ï¼š15%
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-default" onclick="closeCommissionModal()">å–æ¶ˆ</button>
      <button class="btn btn-primary" onclick="saveCommission()">ä¿å­˜</button>
    </div>
  </div>
</div>

<style>
.shop-logo {
  width: 40px;
  height: 40px;
  border-radius: 8px;
  background: var(--bg-color);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
}

.action-btns {
  display: flex;
  gap: 8px;
}

.action-btn {
  padding: 4px 8px;
  font-size: 12px;
  border-radius: 4px;
  cursor: pointer;
  border: none;
  background: var(--bg-color);
  color: var(--text-primary);
}

.action-btn:hover {
  background: var(--primary-light);
  color: var(--primary-color);
}

.action-btn.danger:hover {
  background: #fde8ea;
  color: var(--error-color);
}

.detail-section {
  margin-bottom: 20px;
}

.detail-section-title {
  font-size: 14px;
  font-weight: 600;
  margin-bottom: 12px;
  padding-bottom: 8px;
  border-bottom: 1px solid var(--border-color);
}

.detail-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
}

.detail-item {
  display: flex;
}

.detail-label {
  width: 80px;
  color: var(--text-secondary);
  flex-shrink: 0;
}

.detail-value {
  flex: 1;
  color: var(--text-primary);
}

.cert-images {
  display: flex;
  gap: 12px;
  margin-top: 8px;
}

.cert-image {
  width: 150px;
  height: 100px;
  background: var(--bg-color);
  border-radius: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  color: var(--text-secondary);
}

.tech-list-mini {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: 8px;
}

.tech-tag {
  padding: 4px 12px;
  background: var(--bg-color);
  border-radius: 4px;
  font-size: 12px;
}
</style>

<script>
(function() {
  // æ¨¡æ‹Ÿå•†å®¶æ•°æ®
  const mockShops = [
    { id: 30001, logo: 'ğŸª', name: 'è½»æ¾å…»ç”Ÿé¦†', contact: 'å¼ ç»ç†', phone: '138****1234', techs: 12, orders: 580, commission: 15, verify: 1 },
    { id: 30002, logo: 'ğŸ ', name: 'åº·ä¹æ¨æ‹¿åº—', contact: 'æç»ç†', phone: '139****5678', techs: 8, orders: 420, commission: 15, verify: 1 },
    { id: 30003, logo: 'ğŸ’†', name: 'æ‚¦äº«SPA', contact: 'ç‹ç»ç†', phone: '137****9012', techs: 15, orders: 860, commission: 12, verify: 1 },
    { id: 30004, logo: 'ğŸŒ¿', name: 'é’ç«¹å…»ç”Ÿ', contact: 'åˆ˜ç»ç†', phone: '136****3456', techs: 6, orders: 280, commission: 15, verify: 1 },
    { id: 30005, logo: 'ğŸª', name: 'èˆ’å¿ƒæŒ‰æ‘©', contact: 'é™ˆç»ç†', phone: '135****7890', techs: 0, orders: 0, commission: 15, verify: 0 },
    { id: 30006, logo: 'ğŸ ', name: 'ä¹æ´»æ¨æ‹¿', contact: 'èµµç»ç†', phone: '134****2345', techs: 10, orders: 520, commission: 15, verify: 1 },
    { id: 30007, logo: 'ğŸ’†', name: 'é™å¿ƒå…»ç”Ÿ', contact: 'å­™ç»ç†', phone: '133****6789', techs: 0, orders: 0, commission: 15, verify: 0 },
    { id: 30008, logo: 'ğŸŒ¿', name: 'åº·æ³°æŒ‰æ‘©', contact: 'å‘¨ç»ç†', phone: '132****0123', techs: 5, orders: 180, commission: 15, verify: 2 }
  ];

  const verifyMap = {
    0: { text: 'å¾…å®¡æ ¸', class: 'warning' },
    1: { text: 'å·²è®¤è¯', class: 'success' },
    2: { text: 'å·²åœç”¨', class: 'error' }
  };

  let currentPage = 1;
  const pageSize = 10;
  let filteredShops = [...mockShops];
  let currentShopId = null;

  function init() {
    renderTable();
    renderPagination();
  }

  function renderTable() {
    const tbody = document.getElementById('shopTableBody');
    const start = (currentPage - 1) * pageSize;
    const pageShops = filteredShops.slice(start, start + pageSize);

    tbody.innerHTML = pageShops.map(shop => {
      const verify = verifyMap[shop.verify];
      
      return `
        <tr>
          <td>${shop.id}</td>
          <td><div class="shop-logo">${shop.logo}</div></td>
          <td>${shop.name}</td>
          <td>${shop.contact}</td>
          <td>${shop.phone}</td>
          <td>${shop.techs}</td>
          <td>${shop.orders}</td>
          <td>${shop.commission}%</td>
          <td><span class="status-tag ${verify.class}">${verify.text}</span></td>
          <td>
            <div class="action-btns">
              <button class="action-btn" onclick="viewShopDetail(${shop.id})">è¯¦æƒ…</button>
              ${shop.verify === 1 ? `<button class="action-btn" onclick="setCommission(${shop.id})">ä½£é‡‘</button>` : ''}
              ${shop.verify === 0 ? `<button class="action-btn" onclick="reviewShop(${shop.id})">å®¡æ ¸</button>` : ''}
              ${shop.verify === 1 ? `<button class="action-btn danger" onclick="suspendShop(${shop.id})">åœç”¨</button>` : ''}
            </div>
          </td>
        </tr>
      `;
    }).join('');
  }

  function renderPagination() {
    const totalPages = Math.ceil(filteredShops.length / pageSize);
    const pagination = document.getElementById('pagination');
    
    let html = `
      <button class="pagination-btn" onclick="goToPage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>ä¸Šä¸€é¡µ</button>
    `;
    
    for (let i = 1; i <= Math.min(totalPages, 5); i++) {
      html += `<button class="pagination-btn ${i === currentPage ? 'active' : ''}" onclick="goToPage(${i})">${i}</button>`;
    }
    
    html += `
      <button class="pagination-btn" onclick="goToPage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>ä¸‹ä¸€é¡µ</button>
    `;
    
    pagination.innerHTML = html;
  }

  window.goToPage = function(page) {
    const totalPages = Math.ceil(filteredShops.length / pageSize);
    if (page < 1 || page > totalPages) return;
    currentPage = page;
    renderTable();
    renderPagination();
  };

  window.searchShops = function() {
    const keyword = document.getElementById('searchInput').value.toLowerCase();
    const verify = document.getElementById('verifyFilter').value;
    
    filteredShops = mockShops.filter(shop => {
      const matchKeyword = !keyword || 
        shop.id.toString().includes(keyword) ||
        shop.name.toLowerCase().includes(keyword) ||
        shop.contact.toLowerCase().includes(keyword);
      const matchVerify = !verify || shop.verify.toString() === verify;
      return matchKeyword && matchVerify;
    });
    
    currentPage = 1;
    renderTable();
    renderPagination();
  };

  window.resetFilters = function() {
    document.getElementById('searchInput').value = '';
    document.getElementById('verifyFilter').value = '';
    filteredShops = [...mockShops];
    currentPage = 1;
    renderTable();
    renderPagination();
  };

  window.viewShopDetail = function(shopId) {
    const shop = mockShops.find(s => s.id === shopId);
    if (!shop) return;

    const verify = verifyMap[shop.verify];

    const content = `
      <div class="detail-section">
        <div class="detail-section-title">åŸºæœ¬ä¿¡æ¯</div>
        <div class="detail-grid">
          <div class="detail-item">
            <span class="detail-label">å•†å®¶ID</span>
            <span class="detail-value">${shop.id}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">å•†å®¶åç§°</span>
            <span class="detail-value">${shop.name}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">è”ç³»äºº</span>
            <span class="detail-value">${shop.contact}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">è”ç³»ç”µè¯</span>
            <span class="detail-value">${shop.phone}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">çŠ¶æ€</span>
            <span class="detail-value">
              <span class="status-tag ${verify.class}">${verify.text}</span>
            </span>
          </div>
          <div class="detail-item">
            <span class="detail-label">ä½£é‡‘æ¯”ä¾‹</span>
            <span class="detail-value">${shop.commission}%</span>
          </div>
        </div>
      </div>
      <div class="detail-section">
        <div class="detail-section-title">ç»è¥ç»Ÿè®¡</div>
        <div class="detail-grid">
          <div class="detail-item">
            <span class="detail-label">æŠ€å¸ˆæ•°é‡</span>
            <span class="detail-value">${shop.techs} äºº</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">æ€»è®¢å•æ•°</span>
            <span class="detail-value">${shop.orders} å•</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">æ€»æ”¶å…¥</span>
            <span class="detail-value">Â¥${(shop.orders * 180).toLocaleString()}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">å¹³å°æŠ½æˆ</span>
            <span class="detail-value">Â¥${(shop.orders * 180 * shop.commission / 100).toLocaleString()}</span>
          </div>
        </div>
      </div>
      <div class="detail-section">
        <div class="detail-section-title">è®¤è¯èµ„æ–™</div>
        <div class="cert-images">
          <div class="cert-image">è¥ä¸šæ‰§ç…§</div>
          <div class="cert-image">å«ç”Ÿè®¸å¯è¯</div>
        </div>
      </div>
      <div class="detail-section">
        <div class="detail-section-title">æ——ä¸‹æŠ€å¸ˆ</div>
        <div class="tech-list-mini">
          ${shop.techs > 0 ? `
            <span class="tech-tag">æå¸ˆå‚…</span>
            <span class="tech-tag">ç‹å¸ˆå‚…</span>
            <span class="tech-tag">å¼ å¸ˆå‚…</span>
            ${shop.techs > 3 ? `<span class="tech-tag">+${shop.techs - 3}äºº</span>` : ''}
          ` : '<span style="color:var(--text-secondary)">æš‚æ— æŠ€å¸ˆ</span>'}
        </div>
      </div>
    `;

    document.getElementById('shopDetailContent').innerHTML = content;
    document.getElementById('shopDetailModal').style.display = 'flex';
  };

  window.closeShopDetail = function() {
    document.getElementById('shopDetailModal').style.display = 'none';
  };

  window.setCommission = function(shopId) {
    const shop = mockShops.find(s => s.id === shopId);
    if (!shop) return;

    currentShopId = shopId;
    document.getElementById('commissionShopName').value = shop.name;
    document.getElementById('commissionRate').value = shop.commission;
    document.getElementById('commissionModal').style.display = 'flex';
  };

  window.closeCommissionModal = function() {
    document.getElementById('commissionModal').style.display = 'none';
    currentShopId = null;
  };

  window.saveCommission = function() {
    const rate = parseFloat(document.getElementById('commissionRate').value);
    if (isNaN(rate) || rate < 0 || rate > 100) {
      ADMIN.showToast('è¯·è¾“å…¥æœ‰æ•ˆçš„ä½£é‡‘æ¯”ä¾‹');
      return;
    }

    const shop = mockShops.find(s => s.id === currentShopId);
    if (shop) {
      shop.commission = rate;
      renderTable();
      ADMIN.showToast('ä½£é‡‘æ¯”ä¾‹å·²æ›´æ–°');
    }
    closeCommissionModal();
  };

  window.reviewShop = async function(shopId) {
    const shop = mockShops.find(s => s.id === shopId);
    if (!shop) return;

    const confirmed = await ADMIN.showConfirm(`ç¡®å®šè¦é€šè¿‡å•†å®¶ ${shop.name} çš„å…¥é©»ç”³è¯·å—ï¼Ÿ`);
    if (confirmed) {
      shop.verify = 1;
      renderTable();
      ADMIN.showToast('å·²é€šè¿‡å®¡æ ¸');
    }
  };

  window.suspendShop = async function(shopId) {
    const shop = mockShops.find(s => s.id === shopId);
    if (!shop) return;

    const confirmed = await ADMIN.showConfirm(`ç¡®å®šè¦åœç”¨å•†å®¶ ${shop.name} å—ï¼Ÿè¯¥å•†å®¶æ——ä¸‹æ‰€æœ‰æŠ€å¸ˆä¹Ÿå°†è¢«åœç”¨ã€‚`);
    if (confirmed) {
      shop.verify = 2;
      renderTable();
      ADMIN.showToast('å·²åœç”¨å•†å®¶');
    }
  };

  init();
})();
</script>
