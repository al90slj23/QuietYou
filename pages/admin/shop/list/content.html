<div class="page-shop-list">
  <!-- 统计卡片 -->
  <div class="stat-cards" style="grid-template-columns: repeat(4, 1fr);">
    <div class="stat-card">
      <div class="stat-card-title">总商家数</div>
      <div class="stat-card-value">52</div>
    </div>
    <div class="stat-card">
      <div class="stat-card-title">待审核</div>
      <div class="stat-card-value" style="color:var(--warning-color)">2</div>
    </div>
    <div class="stat-card">
      <div class="stat-card-title">已认证</div>
      <div class="stat-card-value" style="color:var(--success-color)">48</div>
    </div>
    <div class="stat-card">
      <div class="stat-card-title">已停用</div>
      <div class="stat-card-value" style="color:var(--error-color)">2</div>
    </div>
  </div>

  <!-- 筛选栏 -->
  <div class="card">
    <div class="filter-bar">
      <input type="text" class="filter-input" placeholder="搜索商家ID/名称/联系人" id="searchInput">
      <select class="filter-select" id="verifyFilter">
        <option value="">认证状态</option>
        <option value="0">待审核</option>
        <option value="1">已认证</option>
        <option value="2">已停用</option>
      </select>
      <button class="btn btn-primary" onclick="searchShops()">搜索</button>
      <button class="btn btn-default" onclick="resetFilters()">重置</button>
    </div>
  </div>

  <!-- 商家列表 -->
  <div class="card">
    <div class="card-title">
      <span>商家列表</span>
      <button class="btn btn-primary" onclick="ADMIN.navigateTo('shop/pending')">待审核 (2)</button>
    </div>
    <table class="data-table">
      <thead>
        <tr>
          <th>商家ID</th>
          <th>Logo</th>
          <th>商家名称</th>
          <th>联系人</th>
          <th>联系电话</th>
          <th>技师数</th>
          <th>订单数</th>
          <th>佣金比例</th>
          <th>状态</th>
          <th>操作</th>
        </tr>
      </thead>
      <tbody id="shopTableBody">
        <!-- 动态生成 -->
      </tbody>
    </table>
    
    <div class="pagination" id="pagination">
      <!-- 动态生成 -->
    </div>
  </div>
</div>

<!-- 商家详情弹窗 -->
<div class="modal-overlay" id="shopDetailModal" style="display:none">
  <div class="modal" style="min-width:700px">
    <div class="modal-header">
      <span class="modal-title">商家详情</span>
      <span class="modal-close" onclick="closeShopDetail()">×</span>
    </div>
    <div class="modal-body" id="shopDetailContent">
      <!-- 动态生成 -->
    </div>
    <div class="modal-footer">
      <button class="btn btn-default" onclick="closeShopDetail()">关闭</button>
    </div>
  </div>
</div>

<!-- 佣金设置弹窗 -->
<div class="modal-overlay" id="commissionModal" style="display:none">
  <div class="modal" style="min-width:400px">
    <div class="modal-header">
      <span class="modal-title">设置佣金比例</span>
      <span class="modal-close" onclick="closeCommissionModal()">×</span>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label class="form-label">商家名称</label>
        <input type="text" class="form-control" id="commissionShopName" readonly>
      </div>
      <div class="form-group">
        <label class="form-label required">平台佣金比例 (%)</label>
        <input type="number" class="form-control" id="commissionRate" min="0" max="100" step="0.1">
        <div style="font-size:12px;color:var(--text-secondary);margin-top:4px;">
          当前默认比例：15%
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-default" onclick="closeCommissionModal()">取消</button>
      <button class="btn btn-primary" onclick="saveCommission()">保存</button>
    </div>
  </div>
</div>

<style>
.shop-logo {
  width: 40px;
  height: 40px;
  border-radius: 8px;
  background: var(--bg-color);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
}

.action-btns {
  display: flex;
  gap: 8px;
}

.action-btn {
  padding: 4px 8px;
  font-size: 12px;
  border-radius: 4px;
  cursor: pointer;
  border: none;
  background: var(--bg-color);
  color: var(--text-primary);
}

.action-btn:hover {
  background: var(--primary-light);
  color: var(--primary-color);
}

.action-btn.danger:hover {
  background: #fde8ea;
  color: var(--error-color);
}

.detail-section {
  margin-bottom: 20px;
}

.detail-section-title {
  font-size: 14px;
  font-weight: 600;
  margin-bottom: 12px;
  padding-bottom: 8px;
  border-bottom: 1px solid var(--border-color);
}

.detail-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
}

.detail-item {
  display: flex;
}

.detail-label {
  width: 80px;
  color: var(--text-secondary);
  flex-shrink: 0;
}

.detail-value {
  flex: 1;
  color: var(--text-primary);
}

.cert-images {
  display: flex;
  gap: 12px;
  margin-top: 8px;
}

.cert-image {
  width: 150px;
  height: 100px;
  background: var(--bg-color);
  border-radius: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  color: var(--text-secondary);
}

.tech-list-mini {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: 8px;
}

.tech-tag {
  padding: 4px 12px;
  background: var(--bg-color);
  border-radius: 4px;
  font-size: 12px;
}
</style>

<script>
(function() {
  // 模拟商家数据
  const mockShops = [
    { id: 30001, logo: '', name: '轻松养生馆', contact: '张经理', phone: '138****1234', techs: 12, orders: 580, commission: 15, verify: 1 },
    { id: 30002, logo: '', name: '康乐推拿店', contact: '李经理', phone: '139****5678', techs: 8, orders: 420, commission: 15, verify: 1 },
    { id: 30003, logo: '', name: '悦享SPA', contact: '王经理', phone: '137****9012', techs: 15, orders: 860, commission: 12, verify: 1 },
    { id: 30004, logo: '', name: '青竹养生', contact: '刘经理', phone: '136****3456', techs: 6, orders: 280, commission: 15, verify: 1 },
    { id: 30005, logo: '', name: '舒心按摩', contact: '陈经理', phone: '135****7890', techs: 0, orders: 0, commission: 15, verify: 0 },
    { id: 30006, logo: '', name: '乐活推拿', contact: '赵经理', phone: '134****2345', techs: 10, orders: 520, commission: 15, verify: 1 },
    { id: 30007, logo: '', name: '静心养生', contact: '孙经理', phone: '133****6789', techs: 0, orders: 0, commission: 15, verify: 0 },
    { id: 30008, logo: '', name: '康泰按摩', contact: '周经理', phone: '132****0123', techs: 5, orders: 180, commission: 15, verify: 2 }
  ];

  const verifyMap = {
    0: { text: '待审核', class: 'warning' },
    1: { text: '已认证', class: 'success' },
    2: { text: '已停用', class: 'error' }
  };

  let currentPage = 1;
  const pageSize = 10;
  let filteredShops = [...mockShops];
  let currentShopId = null;

  function init() {
    renderTable();
    renderPagination();
  }

  function renderTable() {
    const tbody = document.getElementById('shopTableBody');
    const start = (currentPage - 1) * pageSize;
    const pageShops = filteredShops.slice(start, start + pageSize);

    tbody.innerHTML = pageShops.map(shop => {
      const verify = verifyMap[shop.verify];
      
      return `
        <tr>
          <td>${shop.id}</td>
          <td><div class="shop-logo">${shop.logo}</div></td>
          <td>${shop.name}</td>
          <td>${shop.contact}</td>
          <td>${shop.phone}</td>
          <td>${shop.techs}</td>
          <td>${shop.orders}</td>
          <td>${shop.commission}%</td>
          <td><span class="status-tag ${verify.class}">${verify.text}</span></td>
          <td>
            <div class="action-btns">
              <button class="action-btn" onclick="viewShopDetail(${shop.id})">详情</button>
              ${shop.verify === 1 ? `<button class="action-btn" onclick="setCommission(${shop.id})">佣金</button>` : ''}
              ${shop.verify === 0 ? `<button class="action-btn" onclick="reviewShop(${shop.id})">审核</button>` : ''}
              ${shop.verify === 1 ? `<button class="action-btn danger" onclick="suspendShop(${shop.id})">停用</button>` : ''}
            </div>
          </td>
        </tr>
      `;
    }).join('');
  }

  function renderPagination() {
    const totalPages = Math.ceil(filteredShops.length / pageSize);
    const pagination = document.getElementById('pagination');
    
    let html = `
      <button class="pagination-btn" onclick="goToPage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>上一页</button>
    `;
    
    for (let i = 1; i <= Math.min(totalPages, 5); i++) {
      html += `<button class="pagination-btn ${i === currentPage ? 'active' : ''}" onclick="goToPage(${i})">${i}</button>`;
    }
    
    html += `
      <button class="pagination-btn" onclick="goToPage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>下一页</button>
    `;
    
    pagination.innerHTML = html;
  }

  window.goToPage = function(page) {
    const totalPages = Math.ceil(filteredShops.length / pageSize);
    if (page < 1 || page > totalPages) return;
    currentPage = page;
    renderTable();
    renderPagination();
  };

  window.searchShops = function() {
    const keyword = document.getElementById('searchInput').value.toLowerCase();
    const verify = document.getElementById('verifyFilter').value;
    
    filteredShops = mockShops.filter(shop => {
      const matchKeyword = !keyword || 
        shop.id.toString().includes(keyword) ||
        shop.name.toLowerCase().includes(keyword) ||
        shop.contact.toLowerCase().includes(keyword);
      const matchVerify = !verify || shop.verify.toString() === verify;
      return matchKeyword && matchVerify;
    });
    
    currentPage = 1;
    renderTable();
    renderPagination();
  };

  window.resetFilters = function() {
    document.getElementById('searchInput').value = '';
    document.getElementById('verifyFilter').value = '';
    filteredShops = [...mockShops];
    currentPage = 1;
    renderTable();
    renderPagination();
  };

  window.viewShopDetail = function(shopId) {
    const shop = mockShops.find(s => s.id === shopId);
    if (!shop) return;

    const verify = verifyMap[shop.verify];

    const content = `
      <div class="detail-section">
        <div class="detail-section-title">基本信息</div>
        <div class="detail-grid">
          <div class="detail-item">
            <span class="detail-label">商家ID</span>
            <span class="detail-value">${shop.id}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">商家名称</span>
            <span class="detail-value">${shop.name}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">联系人</span>
            <span class="detail-value">${shop.contact}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">联系电话</span>
            <span class="detail-value">${shop.phone}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">状态</span>
            <span class="detail-value">
              <span class="status-tag ${verify.class}">${verify.text}</span>
            </span>
          </div>
          <div class="detail-item">
            <span class="detail-label">佣金比例</span>
            <span class="detail-value">${shop.commission}%</span>
          </div>
        </div>
      </div>
      <div class="detail-section">
        <div class="detail-section-title">经营统计</div>
        <div class="detail-grid">
          <div class="detail-item">
            <span class="detail-label">技师数量</span>
            <span class="detail-value">${shop.techs} 人</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">总订单数</span>
            <span class="detail-value">${shop.orders} 单</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">总收入</span>
            <span class="detail-value">¥${(shop.orders * 180).toLocaleString()}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">平台抽成</span>
            <span class="detail-value">¥${(shop.orders * 180 * shop.commission / 100).toLocaleString()}</span>
          </div>
        </div>
      </div>
      <div class="detail-section">
        <div class="detail-section-title">认证资料</div>
        <div class="cert-images">
          <div class="cert-image">营业执照</div>
          <div class="cert-image">卫生许可证</div>
        </div>
      </div>
      <div class="detail-section">
        <div class="detail-section-title">旗下技师</div>
        <div class="tech-list-mini">
          ${shop.techs > 0 ? `
            <span class="tech-tag">李师傅</span>
            <span class="tech-tag">王师傅</span>
            <span class="tech-tag">张师傅</span>
            ${shop.techs > 3 ? `<span class="tech-tag">+${shop.techs - 3}人</span>` : ''}
          ` : '<span style="color:var(--text-secondary)">暂无技师</span>'}
        </div>
      </div>
    `;

    document.getElementById('shopDetailContent').innerHTML = content;
    document.getElementById('shopDetailModal').style.display = 'flex';
  };

  window.closeShopDetail = function() {
    document.getElementById('shopDetailModal').style.display = 'none';
  };

  window.setCommission = function(shopId) {
    const shop = mockShops.find(s => s.id === shopId);
    if (!shop) return;

    currentShopId = shopId;
    document.getElementById('commissionShopName').value = shop.name;
    document.getElementById('commissionRate').value = shop.commission;
    document.getElementById('commissionModal').style.display = 'flex';
  };

  window.closeCommissionModal = function() {
    document.getElementById('commissionModal').style.display = 'none';
    currentShopId = null;
  };

  window.saveCommission = function() {
    const rate = parseFloat(document.getElementById('commissionRate').value);
    if (isNaN(rate) || rate < 0 || rate > 100) {
      ADMIN.showToast('请输入有效的佣金比例');
      return;
    }

    const shop = mockShops.find(s => s.id === currentShopId);
    if (shop) {
      shop.commission = rate;
      renderTable();
      ADMIN.showToast('佣金比例已更新');
    }
    closeCommissionModal();
  };

  window.reviewShop = async function(shopId) {
    const shop = mockShops.find(s => s.id === shopId);
    if (!shop) return;

    const confirmed = await ADMIN.showConfirm(`确定要通过商家 ${shop.name} 的入驻申请吗？`);
    if (confirmed) {
      shop.verify = 1;
      renderTable();
      ADMIN.showToast('已通过审核');
    }
  };

  window.suspendShop = async function(shopId) {
    const shop = mockShops.find(s => s.id === shopId);
    if (!shop) return;

    const confirmed = await ADMIN.showConfirm(`确定要停用商家 ${shop.name} 吗？该商家旗下所有技师也将被停用。`);
    if (confirmed) {
      shop.verify = 2;
      renderTable();
      ADMIN.showToast('已停用商家');
    }
  };

  init();
})();
</script>
