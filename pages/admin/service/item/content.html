<div class="page-service-item">
  <!-- ç­›é€‰æ  -->
  <div class="card">
    <div class="filter-bar">
      <select class="filter-select" id="categoryFilter">
        <option value="">å…¨éƒ¨åˆ†ç±»</option>
        <option value="1">ä¸­å¼æ¨æ‹¿</option>
        <option value="2">æ³°å¼æŒ‰æ‘©</option>
        <option value="3">è¶³ç–—ä¿å¥</option>
        <option value="4">ç²¾æ²¹SPA</option>
        <option value="5">è‰¾ç¸ç†ç–—</option>
      </select>
      <select class="filter-select" id="statusFilter">
        <option value="">å…¨éƒ¨çŠ¶æ€</option>
        <option value="1">å¯ç”¨</option>
        <option value="0">ç¦ç”¨</option>
      </select>
      <button class="btn btn-primary" onclick="showAddItem()">+ æ·»åŠ æœåŠ¡</button>
      <button class="btn btn-default" onclick="ADMIN.navigateTo('service/category')">ç®¡ç†åˆ†ç±»</button>
    </div>
  </div>

  <!-- æœåŠ¡åˆ—è¡¨ -->
  <div class="card">
    <div class="card-title">æœåŠ¡é¡¹ç›®</div>
    <table class="data-table">
      <thead>
        <tr>
          <th>å›¾æ ‡</th>
          <th>æœåŠ¡åç§°</th>
          <th>æ‰€å±åˆ†ç±»</th>
          <th>åŸºç¡€ä»·æ ¼</th>
          <th>æ—¶é•¿</th>
          <th>æ’åº</th>
          <th>çŠ¶æ€</th>
          <th>æ“ä½œ</th>
        </tr>
      </thead>
      <tbody id="itemTableBody">
        <!-- åŠ¨æ€ç”Ÿæˆ -->
      </tbody>
    </table>
    
    <div class="pagination" id="pagination">
      <!-- åŠ¨æ€ç”Ÿæˆ -->
    </div>
  </div>
</div>

<!-- æ·»åŠ /ç¼–è¾‘æœåŠ¡å¼¹çª— -->
<div class="modal-overlay" id="itemModal" style="display:none">
  <div class="modal" style="min-width:600px">
    <div class="modal-header">
      <span class="modal-title" id="itemModalTitle">æ·»åŠ æœåŠ¡</span>
      <span class="modal-close" onclick="closeItemModal()">Ã—</span>
    </div>
    <div class="modal-body">
      <div class="form-row">
        <div class="form-group" style="flex:1">
          <label class="form-label required">æœåŠ¡åç§°</label>
          <input type="text" class="form-control" id="itemName" placeholder="è¯·è¾“å…¥æœåŠ¡åç§°">
        </div>
        <div class="form-group" style="width:150px">
          <label class="form-label required">æ‰€å±åˆ†ç±»</label>
          <select class="form-control" id="itemCategory">
            <option value="1">ä¸­å¼æ¨æ‹¿</option>
            <option value="2">æ³°å¼æŒ‰æ‘©</option>
            <option value="3">è¶³ç–—ä¿å¥</option>
            <option value="4">ç²¾æ²¹SPA</option>
            <option value="5">è‰¾ç¸ç†ç–—</option>
          </select>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group" style="flex:1">
          <label class="form-label required">åŸºç¡€ä»·æ ¼ (å…ƒ)</label>
          <input type="number" class="form-control" id="itemPrice" placeholder="0.00" min="0" step="0.01">
        </div>
        <div class="form-group" style="flex:1">
          <label class="form-label">æœ€é«˜ä»·æ ¼ (å…ƒ)</label>
          <input type="number" class="form-control" id="itemPriceMax" placeholder="0.00" min="0" step="0.01">
        </div>
        <div class="form-group" style="flex:1">
          <label class="form-label required">æœåŠ¡æ—¶é•¿ (åˆ†é’Ÿ)</label>
          <input type="number" class="form-control" id="itemDuration" placeholder="60" min="15" step="15">
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">æœåŠ¡æè¿°</label>
        <textarea class="form-control" id="itemDesc" rows="3" placeholder="è¯·è¾“å…¥æœåŠ¡æè¿°"></textarea>
      </div>
      <div class="form-group">
        <label class="form-label">æœåŠ¡æµç¨‹</label>
        <textarea class="form-control" id="itemProcess" rows="3" placeholder="è¯·è¾“å…¥æœåŠ¡æµç¨‹"></textarea>
      </div>
      <div class="form-group">
        <label class="form-label">æ³¨æ„äº‹é¡¹</label>
        <textarea class="form-control" id="itemNotice" rows="2" placeholder="è¯·è¾“å…¥æ³¨æ„äº‹é¡¹"></textarea>
      </div>
      <div class="form-group">
        <label class="form-label">æ’åº</label>
        <input type="number" class="form-control" id="itemSort" value="0" min="0" style="width:100px">
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-default" onclick="closeItemModal()">å–æ¶ˆ</button>
      <button class="btn btn-primary" onclick="saveItem()">ä¿å­˜</button>
    </div>
  </div>
</div>

<style>
.form-row {
  display: flex;
  gap: 16px;
}

.service-icon {
  font-size: 24px;
}

.action-btns {
  display: flex;
  gap: 8px;
}

.action-btn {
  padding: 4px 8px;
  font-size: 12px;
  border-radius: 4px;
  cursor: pointer;
  border: none;
  background: var(--bg-color);
  color: var(--text-primary);
}

.action-btn:hover {
  background: var(--primary-light);
  color: var(--primary-color);
}

.action-btn.danger:hover {
  background: #fde8ea;
  color: var(--error-color);
}
</style>

<script>
(function() {
  // æ¨¡æ‹ŸæœåŠ¡æ•°æ®
  let services = [
    { id: 1, icon: 'ğŸ’†', name: 'ä¸­å¼æ¨æ‹¿60åˆ†é’Ÿ', categoryId: 1, category: 'ä¸­å¼æ¨æ‹¿', price: 198, priceMax: 298, duration: 60, sort: 1, status: 1 },
    { id: 2, icon: 'ğŸ’†', name: 'ä¸­å¼æ¨æ‹¿90åˆ†é’Ÿ', categoryId: 1, category: 'ä¸­å¼æ¨æ‹¿', price: 268, priceMax: 398, duration: 90, sort: 2, status: 1 },
    { id: 3, icon: 'ğŸ’†', name: 'è‚©é¢ˆèˆ’ç¼“45åˆ†é’Ÿ', categoryId: 1, category: 'ä¸­å¼æ¨æ‹¿', price: 158, priceMax: 238, duration: 45, sort: 3, status: 1 },
    { id: 4, icon: 'ğŸ§˜', name: 'æ³°å¼æŒ‰æ‘©60åˆ†é’Ÿ', categoryId: 2, category: 'æ³°å¼æŒ‰æ‘©', price: 228, priceMax: 328, duration: 60, sort: 1, status: 1 },
    { id: 5, icon: 'ğŸ§˜', name: 'æ³°å¼æŒ‰æ‘©90åˆ†é’Ÿ', categoryId: 2, category: 'æ³°å¼æŒ‰æ‘©', price: 298, priceMax: 428, duration: 90, sort: 2, status: 1 },
    { id: 6, icon: 'ğŸ¦¶', name: 'è¶³åº•æŒ‰æ‘©60åˆ†é’Ÿ', categoryId: 3, category: 'è¶³ç–—ä¿å¥', price: 168, priceMax: 258, duration: 60, sort: 1, status: 1 },
    { id: 7, icon: 'ğŸ¦¶', name: 'è¶³åº•æŒ‰æ‘©90åˆ†é’Ÿ', categoryId: 3, category: 'è¶³ç–—ä¿å¥', price: 238, priceMax: 358, duration: 90, sort: 2, status: 1 },
    { id: 8, icon: 'ğŸŒ¿', name: 'å…¨èº«ç²¾æ²¹SPA', categoryId: 4, category: 'ç²¾æ²¹SPA', price: 398, priceMax: 598, duration: 90, sort: 1, status: 1 },
    { id: 9, icon: 'ğŸŒ¿', name: 'é¦™è–°ç²¾æ²¹æŠ¤ç†', categoryId: 4, category: 'ç²¾æ²¹SPA', price: 298, priceMax: 458, duration: 60, sort: 2, status: 1 },
    { id: 10, icon: 'ğŸ”¥', name: 'è‰¾ç¸ç†ç–—60åˆ†é’Ÿ', categoryId: 5, category: 'è‰¾ç¸ç†ç–—', price: 188, priceMax: 288, duration: 60, sort: 1, status: 0 }
  ];

  const categoryIcons = {
    1: 'ğŸ’†',
    2: 'ğŸ§˜',
    3: 'ğŸ¦¶',
    4: 'ğŸŒ¿',
    5: 'ğŸ”¥'
  };

  let currentPage = 1;
  const pageSize = 10;
  let filteredServices = [...services];
  let editingId = null;

  function init() {
    renderTable();
    renderPagination();
    bindFilters();
  }

  function renderTable() {
    const tbody = document.getElementById('itemTableBody');
    const start = (currentPage - 1) * pageSize;
    const pageServices = filteredServices.slice(start, start + pageSize);

    tbody.innerHTML = pageServices.map(item => `
      <tr>
        <td><span class="service-icon">${item.icon}</span></td>
        <td>${item.name}</td>
        <td>${item.category}</td>
        <td>Â¥${item.price}${item.priceMax ? ' - Â¥' + item.priceMax : ''}</td>
        <td>${item.duration}åˆ†é’Ÿ</td>
        <td>${item.sort}</td>
        <td>
          <span class="status-tag ${item.status === 1 ? 'success' : 'error'}">
            ${item.status === 1 ? 'å¯ç”¨' : 'ç¦ç”¨'}
          </span>
        </td>
        <td>
          <div class="action-btns">
            <button class="action-btn" onclick="editItem(${item.id})">ç¼–è¾‘</button>
            <button class="action-btn" onclick="toggleStatus(${item.id})">
              ${item.status === 1 ? 'ç¦ç”¨' : 'å¯ç”¨'}
            </button>
            <button class="action-btn danger" onclick="deleteItem(${item.id})">åˆ é™¤</button>
          </div>
        </td>
      </tr>
    `).join('');
  }

  function renderPagination() {
    const totalPages = Math.ceil(filteredServices.length / pageSize);
    const pagination = document.getElementById('pagination');
    
    let html = `
      <button class="pagination-btn" onclick="goToPage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>ä¸Šä¸€é¡µ</button>
    `;
    
    for (let i = 1; i <= Math.min(totalPages, 5); i++) {
      html += `<button class="pagination-btn ${i === currentPage ? 'active' : ''}" onclick="goToPage(${i})">${i}</button>`;
    }
    
    html += `
      <button class="pagination-btn" onclick="goToPage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>ä¸‹ä¸€é¡µ</button>
    `;
    
    pagination.innerHTML = html;
  }

  function bindFilters() {
    document.getElementById('categoryFilter').addEventListener('change', filterServices);
    document.getElementById('statusFilter').addEventListener('change', filterServices);
  }

  function filterServices() {
    const category = document.getElementById('categoryFilter').value;
    const status = document.getElementById('statusFilter').value;
    
    filteredServices = services.filter(item => {
      const matchCategory = !category || item.categoryId.toString() === category;
      const matchStatus = !status || item.status.toString() === status;
      return matchCategory && matchStatus;
    });
    
    currentPage = 1;
    renderTable();
    renderPagination();
  }

  window.goToPage = function(page) {
    const totalPages = Math.ceil(filteredServices.length / pageSize);
    if (page < 1 || page > totalPages) return;
    currentPage = page;
    renderTable();
    renderPagination();
  };

  window.showAddItem = function() {
    editingId = null;
    document.getElementById('itemModalTitle').textContent = 'æ·»åŠ æœåŠ¡';
    document.getElementById('itemName').value = '';
    document.getElementById('itemCategory').value = '1';
    document.getElementById('itemPrice').value = '';
    document.getElementById('itemPriceMax').value = '';
    document.getElementById('itemDuration').value = '60';
    document.getElementById('itemDesc').value = '';
    document.getElementById('itemProcess').value = '';
    document.getElementById('itemNotice').value = '';
    document.getElementById('itemSort').value = '0';
    document.getElementById('itemModal').style.display = 'flex';
  };

  window.editItem = function(id) {
    const item = services.find(s => s.id === id);
    if (!item) return;

    editingId = id;
    document.getElementById('itemModalTitle').textContent = 'ç¼–è¾‘æœåŠ¡';
    document.getElementById('itemName').value = item.name;
    document.getElementById('itemCategory').value = item.categoryId;
    document.getElementById('itemPrice').value = item.price;
    document.getElementById('itemPriceMax').value = item.priceMax || '';
    document.getElementById('itemDuration').value = item.duration;
    document.getElementById('itemDesc').value = item.desc || '';
    document.getElementById('itemProcess').value = item.process || '';
    document.getElementById('itemNotice').value = item.notice || '';
    document.getElementById('itemSort').value = item.sort;
    document.getElementById('itemModal').style.display = 'flex';
  };

  window.closeItemModal = function() {
    document.getElementById('itemModal').style.display = 'none';
    editingId = null;
  };

  window.saveItem = function() {
    const name = document.getElementById('itemName').value.trim();
    const categoryId = parseInt(document.getElementById('itemCategory').value);
    const price = parseFloat(document.getElementById('itemPrice').value);
    const priceMax = parseFloat(document.getElementById('itemPriceMax').value) || null;
    const duration = parseInt(document.getElementById('itemDuration').value);
    const sort = parseInt(document.getElementById('itemSort').value) || 0;

    if (!name) {
      ADMIN.showToast('è¯·è¾“å…¥æœåŠ¡åç§°');
      return;
    }
    if (isNaN(price) || price <= 0) {
      ADMIN.showToast('è¯·è¾“å…¥æœ‰æ•ˆçš„åŸºç¡€ä»·æ ¼');
      return;
    }
    if (isNaN(duration) || duration < 15) {
      ADMIN.showToast('æœåŠ¡æ—¶é•¿è‡³å°‘15åˆ†é’Ÿ');
      return;
    }

    const categoryNames = { 1: 'ä¸­å¼æ¨æ‹¿', 2: 'æ³°å¼æŒ‰æ‘©', 3: 'è¶³ç–—ä¿å¥', 4: 'ç²¾æ²¹SPA', 5: 'è‰¾ç¸ç†ç–—' };

    if (editingId) {
      const item = services.find(s => s.id === editingId);
      if (item) {
        item.name = name;
        item.categoryId = categoryId;
        item.category = categoryNames[categoryId];
        item.icon = categoryIcons[categoryId];
        item.price = price;
        item.priceMax = priceMax;
        item.duration = duration;
        item.sort = sort;
      }
      ADMIN.showToast('æœåŠ¡å·²æ›´æ–°');
    } else {
      const newId = Math.max(...services.map(s => s.id)) + 1;
      services.push({
        id: newId,
        icon: categoryIcons[categoryId],
        name,
        categoryId,
        category: categoryNames[categoryId],
        price,
        priceMax,
        duration,
        sort,
        status: 1
      });
      ADMIN.showToast('æœåŠ¡å·²æ·»åŠ ');
    }

    filterServices();
    closeItemModal();
  };

  window.toggleStatus = function(id) {
    const item = services.find(s => s.id === id);
    if (item) {
      item.status = item.status === 1 ? 0 : 1;
      filterServices();
      ADMIN.showToast(item.status === 1 ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨');
    }
  };

  window.deleteItem = async function(id) {
    const item = services.find(s => s.id === id);
    if (!item) return;

    const confirmed = await ADMIN.showConfirm(`ç¡®å®šè¦åˆ é™¤æœåŠ¡ ${item.name} å—ï¼Ÿ`);
    if (confirmed) {
      services = services.filter(s => s.id !== id);
      filterServices();
      ADMIN.showToast('æœåŠ¡å·²åˆ é™¤');
    }
  };

  init();
})();
</script>
