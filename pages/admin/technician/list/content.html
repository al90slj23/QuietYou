<div class="page-technician-list">
  <!-- ç»Ÿè®¡å¡ç‰‡ -->
  <div class="stat-cards" style="grid-template-columns: repeat(5, 1fr);">
    <div class="stat-card">
      <div class="stat-card-title">æ€»æŠ€å¸ˆæ•°</div>
      <div class="stat-card-value">386</div>
    </div>
    <div class="stat-card">
      <div class="stat-card-title">å¾…å®¡æ ¸</div>
      <div class="stat-card-value" style="color:var(--warning-color)">5</div>
    </div>
    <div class="stat-card">
      <div class="stat-card-title">å·²è®¤è¯</div>
      <div class="stat-card-value" style="color:var(--success-color)">368</div>
    </div>
    <div class="stat-card">
      <div class="stat-card-title">å·²æ‹’ç»</div>
      <div class="stat-card-value" style="color:var(--error-color)">13</div>
    </div>
    <div class="stat-card">
      <div class="stat-card-title">å½“å‰åœ¨çº¿</div>
      <div class="stat-card-value" style="color:var(--primary-color)">89</div>
    </div>
  </div>

  <!-- ç­›é€‰æ  -->
  <div class="card">
    <div class="filter-bar">
      <input type="text" class="filter-input" placeholder="æœç´¢æŠ€å¸ˆID/å§“å/æ‰‹æœºå·" id="searchInput">
      <select class="filter-select" id="verifyFilter">
        <option value="">è®¤è¯çŠ¶æ€</option>
        <option value="0">å¾…å®¡æ ¸</option>
        <option value="1">å·²è®¤è¯</option>
        <option value="2">å·²æ‹’ç»</option>
      </select>
      <select class="filter-select" id="onlineFilter">
        <option value="">åœ¨çº¿çŠ¶æ€</option>
        <option value="1">åœ¨çº¿</option>
        <option value="0">ç¦»çº¿</option>
        <option value="2">å¿™ç¢Œ</option>
      </select>
      <select class="filter-select" id="shopFilter">
        <option value="">æ‰€å±å•†å®¶</option>
        <option value="1">è½»æ¾å…»ç”Ÿé¦†</option>
        <option value="2">åº·ä¹æ¨æ‹¿åº—</option>
        <option value="3">æ‚¦äº«SPA</option>
      </select>
      <button class="btn btn-primary" onclick="searchTechs()">æœç´¢</button>
      <button class="btn btn-default" onclick="resetFilters()">é‡ç½®</button>
    </div>
  </div>

  <!-- æŠ€å¸ˆåˆ—è¡¨ -->
  <div class="card">
    <div class="card-title">
      <span>æŠ€å¸ˆåˆ—è¡¨</span>
      <button class="btn btn-primary" onclick="ADMIN.navigateTo('technician/pending')">å¾…å®¡æ ¸ (5)</button>
    </div>
    <table class="data-table">
      <thead>
        <tr>
          <th>æŠ€å¸ˆID</th>
          <th>å¤´åƒ</th>
          <th>å§“å</th>
          <th>æ‰‹æœºå·</th>
          <th>æ‰€å±å•†å®¶</th>
          <th>è¯„åˆ†</th>
          <th>è®¢å•æ•°</th>
          <th>è®¤è¯çŠ¶æ€</th>
          <th>åœ¨çº¿çŠ¶æ€</th>
          <th>æ“ä½œ</th>
        </tr>
      </thead>
      <tbody id="techTableBody">
        <!-- åŠ¨æ€ç”Ÿæˆ -->
      </tbody>
    </table>
    
    <div class="pagination" id="pagination">
      <!-- åŠ¨æ€ç”Ÿæˆ -->
    </div>
  </div>
</div>

<!-- æŠ€å¸ˆè¯¦æƒ…å¼¹çª— -->
<div class="modal-overlay" id="techDetailModal" style="display:none">
  <div class="modal" style="min-width:700px">
    <div class="modal-header">
      <span class="modal-title">æŠ€å¸ˆè¯¦æƒ…</span>
      <span class="modal-close" onclick="closeTechDetail()">Ã—</span>
    </div>
    <div class="modal-body" id="techDetailContent">
      <!-- åŠ¨æ€ç”Ÿæˆ -->
    </div>
    <div class="modal-footer">
      <button class="btn btn-default" onclick="closeTechDetail()">å…³é—­</button>
    </div>
  </div>
</div>

<style>
.tech-avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: var(--bg-color);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
}

.rating-stars {
  color: #ffc107;
}

.action-btns {
  display: flex;
  gap: 8px;
}

.action-btn {
  padding: 4px 8px;
  font-size: 12px;
  border-radius: 4px;
  cursor: pointer;
  border: none;
  background: var(--bg-color);
  color: var(--text-primary);
}

.action-btn:hover {
  background: var(--primary-light);
  color: var(--primary-color);
}

.action-btn.danger:hover {
  background: #fde8ea;
  color: var(--error-color);
}

.detail-section {
  margin-bottom: 20px;
}

.detail-section-title {
  font-size: 14px;
  font-weight: 600;
  margin-bottom: 12px;
  padding-bottom: 8px;
  border-bottom: 1px solid var(--border-color);
}

.detail-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
}

.detail-item {
  display: flex;
}

.detail-label {
  width: 80px;
  color: var(--text-secondary);
  flex-shrink: 0;
}

.detail-value {
  flex: 1;
  color: var(--text-primary);
}

.cert-images {
  display: flex;
  gap: 12px;
  margin-top: 8px;
}

.cert-image {
  width: 120px;
  height: 80px;
  background: var(--bg-color);
  border-radius: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  color: var(--text-secondary);
}

.online-dot {
  display: inline-block;
  width: 8px;
  height: 8px;
  border-radius: 50%;
  margin-right: 6px;
}

.online-dot.online { background: var(--success-color); }
.online-dot.offline { background: var(--text-placeholder); }
.online-dot.busy { background: var(--warning-color); }
</style>

<script>
(function() {
  // æ¨¡æ‹ŸæŠ€å¸ˆæ•°æ®
  const mockTechs = [
    { id: 20001, avatar: 'ğŸ‘¨', name: 'æå¸ˆå‚…', phone: '138****1234', shop: 'è½»æ¾å…»ç”Ÿé¦†', shopId: 1, rating: 4.98, orders: 128, verify: 1, online: 1 },
    { id: 20002, avatar: 'ğŸ‘¨', name: 'ç‹å¸ˆå‚…', phone: '139****5678', shop: 'åº·ä¹æ¨æ‹¿åº—', shopId: 2, rating: 4.95, orders: 115, verify: 1, online: 1 },
    { id: 20003, avatar: 'ğŸ‘©', name: 'å¼ å¸ˆå‚…', phone: '137****9012', shop: 'æ‚¦äº«SPA', shopId: 3, rating: 4.92, orders: 108, verify: 1, online: 2 },
    { id: 20004, avatar: 'ğŸ‘¨', name: 'åˆ˜å¸ˆå‚…', phone: '136****3456', shop: 'è½»æ¾å…»ç”Ÿé¦†', shopId: 1, rating: 4.90, orders: 96, verify: 1, online: 0 },
    { id: 20005, avatar: 'ğŸ‘©', name: 'é™ˆå¸ˆå‚…', phone: '135****7890', shop: 'åº·ä¹æ¨æ‹¿åº—', shopId: 2, rating: 4.88, orders: 89, verify: 1, online: 1 },
    { id: 20006, avatar: 'ğŸ‘¨', name: 'èµµå¸ˆå‚…', phone: '134****2345', shop: 'æ‚¦äº«SPA', shopId: 3, rating: 4.85, orders: 76, verify: 1, online: 0 },
    { id: 20007, avatar: 'ğŸ‘¨', name: 'å­™å¸ˆå‚…', phone: '133****6789', shop: 'è½»æ¾å…»ç”Ÿé¦†', shopId: 1, rating: 0, orders: 0, verify: 0, online: 0 },
    { id: 20008, avatar: 'ğŸ‘©', name: 'å‘¨å¸ˆå‚…', phone: '132****0123', shop: 'åº·ä¹æ¨æ‹¿åº—', shopId: 2, rating: 4.75, orders: 45, verify: 1, online: 1 },
    { id: 20009, avatar: 'ğŸ‘¨', name: 'å´å¸ˆå‚…', phone: '131****4567', shop: '', shopId: 0, rating: 0, orders: 0, verify: 2, online: 0 },
    { id: 20010, avatar: 'ğŸ‘©', name: 'éƒ‘å¸ˆå‚…', phone: '130****8901', shop: 'æ‚¦äº«SPA', shopId: 3, rating: 4.80, orders: 62, verify: 1, online: 1 }
  ];

  const verifyMap = {
    0: { text: 'å¾…å®¡æ ¸', class: 'warning' },
    1: { text: 'å·²è®¤è¯', class: 'success' },
    2: { text: 'å·²æ‹’ç»', class: 'error' }
  };

  const onlineMap = {
    0: { text: 'ç¦»çº¿', class: 'offline' },
    1: { text: 'åœ¨çº¿', class: 'online' },
    2: { text: 'å¿™ç¢Œ', class: 'busy' }
  };

  let currentPage = 1;
  const pageSize = 10;
  let filteredTechs = [...mockTechs];

  function init() {
    renderTable();
    renderPagination();
  }

  function renderTable() {
    const tbody = document.getElementById('techTableBody');
    const start = (currentPage - 1) * pageSize;
    const pageTechs = filteredTechs.slice(start, start + pageSize);

    tbody.innerHTML = pageTechs.map(tech => {
      const verify = verifyMap[tech.verify];
      const online = onlineMap[tech.online];
      
      return `
        <tr>
          <td>${tech.id}</td>
          <td><div class="tech-avatar">${tech.avatar}</div></td>
          <td>${tech.name}</td>
          <td>${tech.phone}</td>
          <td>${tech.shop || '-'}</td>
          <td><span class="rating-stars">â­</span> ${tech.rating || '-'}</td>
          <td>${tech.orders}</td>
          <td><span class="status-tag ${verify.class}">${verify.text}</span></td>
          <td>
            <span class="online-dot ${online.class}"></span>${online.text}
          </td>
          <td>
            <div class="action-btns">
              <button class="action-btn" onclick="viewTechDetail(${tech.id})">è¯¦æƒ…</button>
              ${tech.verify === 0 ? `<button class="action-btn" onclick="reviewTech(${tech.id})">å®¡æ ¸</button>` : ''}
              ${tech.verify === 1 ? `<button class="action-btn danger" onclick="suspendTech(${tech.id})">åœç”¨</button>` : ''}
            </div>
          </td>
        </tr>
      `;
    }).join('');
  }

  function renderPagination() {
    const totalPages = Math.ceil(filteredTechs.length / pageSize);
    const pagination = document.getElementById('pagination');
    
    let html = `
      <button class="pagination-btn" onclick="goToPage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>ä¸Šä¸€é¡µ</button>
    `;
    
    for (let i = 1; i <= Math.min(totalPages, 5); i++) {
      html += `<button class="pagination-btn ${i === currentPage ? 'active' : ''}" onclick="goToPage(${i})">${i}</button>`;
    }
    
    html += `
      <button class="pagination-btn" onclick="goToPage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>ä¸‹ä¸€é¡µ</button>
    `;
    
    pagination.innerHTML = html;
  }

  window.goToPage = function(page) {
    const totalPages = Math.ceil(filteredTechs.length / pageSize);
    if (page < 1 || page > totalPages) return;
    currentPage = page;
    renderTable();
    renderPagination();
  };

  window.searchTechs = function() {
    const keyword = document.getElementById('searchInput').value.toLowerCase();
    const verify = document.getElementById('verifyFilter').value;
    const online = document.getElementById('onlineFilter').value;
    const shop = document.getElementById('shopFilter').value;
    
    filteredTechs = mockTechs.filter(tech => {
      const matchKeyword = !keyword || 
        tech.id.toString().includes(keyword) ||
        tech.name.toLowerCase().includes(keyword) ||
        tech.phone.includes(keyword);
      const matchVerify = !verify || tech.verify.toString() === verify;
      const matchOnline = !online || tech.online.toString() === online;
      const matchShop = !shop || tech.shopId.toString() === shop;
      return matchKeyword && matchVerify && matchOnline && matchShop;
    });
    
    currentPage = 1;
    renderTable();
    renderPagination();
  };

  window.resetFilters = function() {
    document.getElementById('searchInput').value = '';
    document.getElementById('verifyFilter').value = '';
    document.getElementById('onlineFilter').value = '';
    document.getElementById('shopFilter').value = '';
    filteredTechs = [...mockTechs];
    currentPage = 1;
    renderTable();
    renderPagination();
  };

  window.viewTechDetail = function(techId) {
    const tech = mockTechs.find(t => t.id === techId);
    if (!tech) return;

    const verify = verifyMap[tech.verify];
    const online = onlineMap[tech.online];

    const content = `
      <div class="detail-section">
        <div class="detail-section-title">åŸºæœ¬ä¿¡æ¯</div>
        <div class="detail-grid">
          <div class="detail-item">
            <span class="detail-label">æŠ€å¸ˆID</span>
            <span class="detail-value">${tech.id}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">å§“å</span>
            <span class="detail-value">${tech.name}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">æ‰‹æœºå·</span>
            <span class="detail-value">${tech.phone}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">æ‰€å±å•†å®¶</span>
            <span class="detail-value">${tech.shop || 'æ— '}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">è®¤è¯çŠ¶æ€</span>
            <span class="detail-value">
              <span class="status-tag ${verify.class}">${verify.text}</span>
            </span>
          </div>
          <div class="detail-item">
            <span class="detail-label">åœ¨çº¿çŠ¶æ€</span>
            <span class="detail-value">
              <span class="online-dot ${online.class}"></span>${online.text}
            </span>
          </div>
        </div>
      </div>
      <div class="detail-section">
        <div class="detail-section-title">æœåŠ¡ç»Ÿè®¡</div>
        <div class="detail-grid">
          <div class="detail-item">
            <span class="detail-label">è¯„åˆ†</span>
            <span class="detail-value"><span class="rating-stars">â­</span> ${tech.rating || '-'}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">å®Œæˆè®¢å•</span>
            <span class="detail-value">${tech.orders} å•</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">å®Œæˆç‡</span>
            <span class="detail-value">98.5%</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">æŠ•è¯‰æ•°</span>
            <span class="detail-value">0</span>
          </div>
        </div>
      </div>
      <div class="detail-section">
        <div class="detail-section-title">è®¤è¯èµ„æ–™</div>
        <div class="cert-images">
          <div class="cert-image">èº«ä»½è¯æ­£é¢</div>
          <div class="cert-image">èº«ä»½è¯èƒŒé¢</div>
          <div class="cert-image">å¥åº·è¯</div>
          <div class="cert-image">ä¸“ä¸šè¯ä¹¦</div>
        </div>
      </div>
    `;

    document.getElementById('techDetailContent').innerHTML = content;
    document.getElementById('techDetailModal').style.display = 'flex';
  };

  window.closeTechDetail = function() {
    document.getElementById('techDetailModal').style.display = 'none';
  };

  window.reviewTech = async function(techId) {
    const tech = mockTechs.find(t => t.id === techId);
    if (!tech) return;

    const confirmed = await ADMIN.showConfirm(`ç¡®å®šè¦é€šè¿‡æŠ€å¸ˆ ${tech.name} çš„è®¤è¯ç”³è¯·å—ï¼Ÿ`);
    if (confirmed) {
      tech.verify = 1;
      renderTable();
      ADMIN.showToast('å·²é€šè¿‡è®¤è¯');
    }
  };

  window.suspendTech = async function(techId) {
    const tech = mockTechs.find(t => t.id === techId);
    if (!tech) return;

    const confirmed = await ADMIN.showConfirm(`ç¡®å®šè¦åœç”¨æŠ€å¸ˆ ${tech.name} å—ï¼Ÿ`);
    if (confirmed) {
      tech.verify = 2;
      tech.online = 0;
      renderTable();
      ADMIN.showToast('å·²åœç”¨æŠ€å¸ˆ');
    }
  };

  init();
})();
</script>
