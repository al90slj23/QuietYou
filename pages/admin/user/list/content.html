<div class="page-user-list">
  <!-- ç­›é€‰æ  -->
  <div class="card">
    <div class="filter-bar">
      <input type="text" class="filter-input" placeholder="æœç´¢ç”¨æˆ·ID/æ‰‹æœºå·/æ˜µç§°" id="searchInput">
      <select class="filter-select" id="statusFilter">
        <option value="">å…¨éƒ¨çŠ¶æ€</option>
        <option value="1">æ­£å¸¸</option>
        <option value="0">å·²ç¦ç”¨</option>
      </select>
      <input type="date" class="filter-input" id="dateFrom" style="min-width:140px">
      <span style="color:var(--text-secondary)">è‡³</span>
      <input type="date" class="filter-input" id="dateTo" style="min-width:140px">
      <button class="btn btn-primary" onclick="searchUsers()">æœç´¢</button>
      <button class="btn btn-default" onclick="resetFilters()">é‡ç½®</button>
    </div>
  </div>

  <!-- ç”¨æˆ·åˆ—è¡¨ -->
  <div class="card">
    <div class="card-title">
      <span>ç”¨æˆ·åˆ—è¡¨</span>
      <span class="total-count">å…± <span id="totalCount">12,580</span> ä½ç”¨æˆ·</span>
    </div>
    <table class="data-table">
      <thead>
        <tr>
          <th>ç”¨æˆ·ID</th>
          <th>å¤´åƒ</th>
          <th>æ˜µç§°</th>
          <th>æ‰‹æœºå·</th>
          <th>æ³¨å†Œæ—¶é—´</th>
          <th>è®¢å•æ•°</th>
          <th>æ¶ˆè´¹é‡‘é¢</th>
          <th>çŠ¶æ€</th>
          <th>æ“ä½œ</th>
        </tr>
      </thead>
      <tbody id="userTableBody">
        <!-- åŠ¨æ€ç”Ÿæˆ -->
      </tbody>
    </table>
    
    <div class="pagination" id="pagination">
      <!-- åŠ¨æ€ç”Ÿæˆ -->
    </div>
  </div>
</div>

<!-- ç”¨æˆ·è¯¦æƒ…å¼¹çª— -->
<div class="modal-overlay" id="userDetailModal" style="display:none">
  <div class="modal" style="min-width:600px">
    <div class="modal-header">
      <span class="modal-title">ç”¨æˆ·è¯¦æƒ…</span>
      <span class="modal-close" onclick="closeUserDetail()">Ã—</span>
    </div>
    <div class="modal-body" id="userDetailContent">
      <!-- åŠ¨æ€ç”Ÿæˆ -->
    </div>
    <div class="modal-footer">
      <button class="btn btn-default" onclick="closeUserDetail()">å…³é—­</button>
    </div>
  </div>
</div>

<style>
.total-count {
  font-size: 14px;
  font-weight: normal;
  color: var(--text-secondary);
}

.user-avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: var(--bg-color);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
}

.action-btns {
  display: flex;
  gap: 8px;
}

.action-btn {
  padding: 4px 8px;
  font-size: 12px;
  border-radius: 4px;
  cursor: pointer;
  border: none;
  background: var(--bg-color);
  color: var(--text-primary);
}

.action-btn:hover {
  background: var(--primary-light);
  color: var(--primary-color);
}

.action-btn.danger:hover {
  background: #fde8ea;
  color: var(--error-color);
}

.detail-section {
  margin-bottom: 20px;
}

.detail-section-title {
  font-size: 14px;
  font-weight: 600;
  margin-bottom: 12px;
  padding-bottom: 8px;
  border-bottom: 1px solid var(--border-color);
}

.detail-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
}

.detail-item {
  display: flex;
}

.detail-label {
  width: 80px;
  color: var(--text-secondary);
  flex-shrink: 0;
}

.detail-value {
  flex: 1;
  color: var(--text-primary);
}

.order-history {
  max-height: 200px;
  overflow-y: auto;
}

.order-history-item {
  display: flex;
  justify-content: space-between;
  padding: 8px 0;
  border-bottom: 1px solid var(--border-color);
  font-size: 13px;
}

.order-history-item:last-child {
  border-bottom: none;
}
</style>

<script>
(function() {
  // æ¨¡æ‹Ÿç”¨æˆ·æ•°æ®
  const mockUsers = [
    { id: 10001, avatar: 'ğŸ‘¤', nickname: 'å°æ˜', phone: '138****1234', registerTime: '2025-12-01 10:30', orders: 15, amount: 4580, status: 1 },
    { id: 10002, avatar: 'ğŸ‘©', nickname: 'å°çº¢', phone: '139****5678', registerTime: '2025-12-05 14:20', orders: 8, amount: 2360, status: 1 },
    { id: 10003, avatar: 'ğŸ‘¨', nickname: 'å¼ ä¸‰', phone: '137****9012', registerTime: '2025-12-10 09:15', orders: 22, amount: 6890, status: 1 },
    { id: 10004, avatar: 'ğŸ‘¤', nickname: 'æå››', phone: '136****3456', registerTime: '2025-12-15 16:45', orders: 5, amount: 1580, status: 0 },
    { id: 10005, avatar: 'ğŸ‘©', nickname: 'ç‹äº”', phone: '135****7890', registerTime: '2025-12-20 11:30', orders: 12, amount: 3680, status: 1 },
    { id: 10006, avatar: 'ğŸ‘¨', nickname: 'èµµå…­', phone: '134****2345', registerTime: '2025-12-25 08:00', orders: 3, amount: 890, status: 1 },
    { id: 10007, avatar: 'ğŸ‘¤', nickname: 'é’±ä¸ƒ', phone: '133****6789', registerTime: '2026-01-01 13:20', orders: 18, amount: 5460, status: 1 },
    { id: 10008, avatar: 'ğŸ‘©', nickname: 'å­™å…«', phone: '132****0123', registerTime: '2026-01-05 17:40', orders: 7, amount: 2180, status: 1 },
    { id: 10009, avatar: 'ğŸ‘¨', nickname: 'å‘¨ä¹', phone: '131****4567', registerTime: '2026-01-08 10:10', orders: 0, amount: 0, status: 1 },
    { id: 10010, avatar: 'ğŸ‘¤', nickname: 'å´å', phone: '130****8901', registerTime: '2026-01-10 15:55', orders: 2, amount: 596, status: 1 }
  ];

  let currentPage = 1;
  const pageSize = 10;
  let filteredUsers = [...mockUsers];

  function init() {
    renderTable();
    renderPagination();
  }

  function renderTable() {
    const tbody = document.getElementById('userTableBody');
    const start = (currentPage - 1) * pageSize;
    const pageUsers = filteredUsers.slice(start, start + pageSize);

    tbody.innerHTML = pageUsers.map(user => `
      <tr>
        <td>${user.id}</td>
        <td><div class="user-avatar">${user.avatar}</div></td>
        <td>${user.nickname}</td>
        <td>${user.phone}</td>
        <td>${user.registerTime}</td>
        <td>${user.orders}</td>
        <td>Â¥${user.amount.toLocaleString()}</td>
        <td>
          <span class="status-tag ${user.status === 1 ? 'success' : 'error'}">
            ${user.status === 1 ? 'æ­£å¸¸' : 'å·²ç¦ç”¨'}
          </span>
        </td>
        <td>
          <div class="action-btns">
            <button class="action-btn" onclick="viewUserDetail(${user.id})">è¯¦æƒ…</button>
            <button class="action-btn ${user.status === 1 ? 'danger' : ''}" onclick="toggleUserStatus(${user.id})">
              ${user.status === 1 ? 'ç¦ç”¨' : 'å¯ç”¨'}
            </button>
          </div>
        </td>
      </tr>
    `).join('');

    document.getElementById('totalCount').textContent = filteredUsers.length.toLocaleString();
  }

  function renderPagination() {
    const totalPages = Math.ceil(filteredUsers.length / pageSize);
    const pagination = document.getElementById('pagination');
    
    let html = `
      <button class="pagination-btn" onclick="goToPage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>ä¸Šä¸€é¡µ</button>
    `;
    
    for (let i = 1; i <= Math.min(totalPages, 5); i++) {
      html += `<button class="pagination-btn ${i === currentPage ? 'active' : ''}" onclick="goToPage(${i})">${i}</button>`;
    }
    
    html += `
      <button class="pagination-btn" onclick="goToPage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>ä¸‹ä¸€é¡µ</button>
    `;
    
    pagination.innerHTML = html;
  }

  window.goToPage = function(page) {
    const totalPages = Math.ceil(filteredUsers.length / pageSize);
    if (page < 1 || page > totalPages) return;
    currentPage = page;
    renderTable();
    renderPagination();
  };

  window.searchUsers = function() {
    const keyword = document.getElementById('searchInput').value.toLowerCase();
    const status = document.getElementById('statusFilter').value;
    
    filteredUsers = mockUsers.filter(user => {
      const matchKeyword = !keyword || 
        user.id.toString().includes(keyword) ||
        user.nickname.toLowerCase().includes(keyword) ||
        user.phone.includes(keyword);
      const matchStatus = !status || user.status.toString() === status;
      return matchKeyword && matchStatus;
    });
    
    currentPage = 1;
    renderTable();
    renderPagination();
  };

  window.resetFilters = function() {
    document.getElementById('searchInput').value = '';
    document.getElementById('statusFilter').value = '';
    document.getElementById('dateFrom').value = '';
    document.getElementById('dateTo').value = '';
    filteredUsers = [...mockUsers];
    currentPage = 1;
    renderTable();
    renderPagination();
  };

  window.viewUserDetail = function(userId) {
    const user = mockUsers.find(u => u.id === userId);
    if (!user) return;

    const content = `
      <div class="detail-section">
        <div class="detail-section-title">åŸºæœ¬ä¿¡æ¯</div>
        <div class="detail-grid">
          <div class="detail-item">
            <span class="detail-label">ç”¨æˆ·ID</span>
            <span class="detail-value">${user.id}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">æ˜µç§°</span>
            <span class="detail-value">${user.nickname}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">æ‰‹æœºå·</span>
            <span class="detail-value">${user.phone}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">æ³¨å†Œæ—¶é—´</span>
            <span class="detail-value">${user.registerTime}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">çŠ¶æ€</span>
            <span class="detail-value">
              <span class="status-tag ${user.status === 1 ? 'success' : 'error'}">
                ${user.status === 1 ? 'æ­£å¸¸' : 'å·²ç¦ç”¨'}
              </span>
            </span>
          </div>
        </div>
      </div>
      <div class="detail-section">
        <div class="detail-section-title">æ¶ˆè´¹ç»Ÿè®¡</div>
        <div class="detail-grid">
          <div class="detail-item">
            <span class="detail-label">è®¢å•æ•°</span>
            <span class="detail-value">${user.orders} å•</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">æ¶ˆè´¹é‡‘é¢</span>
            <span class="detail-value">Â¥${user.amount.toLocaleString()}</span>
          </div>
        </div>
      </div>
      <div class="detail-section">
        <div class="detail-section-title">æœ€è¿‘è®¢å•</div>
        <div class="order-history">
          <div class="order-history-item">
            <span>QY20260110001 - ä¸­å¼æ¨æ‹¿60åˆ†é’Ÿ</span>
            <span>Â¥298</span>
          </div>
          <div class="order-history-item">
            <span>QY20260108002 - è‚©é¢ˆèˆ’ç¼“45åˆ†é’Ÿ</span>
            <span>Â¥198</span>
          </div>
          <div class="order-history-item">
            <span>QY20260105003 - è¶³åº•æŒ‰æ‘©90åˆ†é’Ÿ</span>
            <span>Â¥358</span>
          </div>
        </div>
      </div>
    `;

    document.getElementById('userDetailContent').innerHTML = content;
    document.getElementById('userDetailModal').style.display = 'flex';
  };

  window.closeUserDetail = function() {
    document.getElementById('userDetailModal').style.display = 'none';
  };

  window.toggleUserStatus = async function(userId) {
    const user = mockUsers.find(u => u.id === userId);
    if (!user) return;

    const action = user.status === 1 ? 'ç¦ç”¨' : 'å¯ç”¨';
    const confirmed = await ADMIN.showConfirm(`ç¡®å®šè¦${action}ç”¨æˆ· ${user.nickname} å—ï¼Ÿ`);
    
    if (confirmed) {
      user.status = user.status === 1 ? 0 : 1;
      renderTable();
      ADMIN.showToast(`å·²${action}ç”¨æˆ·`);
    }
  };

  init();
})();
</script>
