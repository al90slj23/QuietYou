<div class="order-list-page" id="orderListPage">
  <!-- è®¢å•çŠ¶æ€æ ‡ç­¾é¡µ -->
  <div class="status-tabs">
    <div class="tab-item active" data-status="all" onclick="switchTab('all', this)">å…¨éƒ¨</div>
    <div class="tab-item" data-status="0" onclick="switchTab('0', this)">å¾…æ”¯ä»˜</div>
    <div class="tab-item" data-status="1,2" onclick="switchTab('1,2', this)">å¾…æœåŠ¡</div>
    <div class="tab-item" data-status="3,4" onclick="switchTab('3,4', this)">è¿›è¡Œä¸­</div>
    <div class="tab-item" data-status="5" onclick="switchTab('5', this)">å·²å®Œæˆ</div>
    <div class="tab-item" data-status="6,7" onclick="switchTab('6,7', this)">å·²å–æ¶ˆ</div>
  </div>

  <!-- è®¢å•åˆ—è¡¨ -->
  <div class="order-list" id="orderList">
    <!-- åŠ¨æ€åŠ è½½ -->
  </div>

  <!-- ç©ºçŠ¶æ€ -->
  <div class="empty-state" id="emptyState" style="display: none;">
    <div class="empty-icon">ğŸ“‹</div>
    <div class="empty-text">æš‚æ— è®¢å•</div>
    <button class="btn btn-primary" onclick="QY.navigateTo('home')">å»é¢„çº¦æœåŠ¡</button>
  </div>
</div>

<style>
.order-list-page {
  background: var(--bg-color);
  min-height: 100%;
}

/* Status Tabs */
.status-tabs {
  display: flex;
  background: var(--bg-white);
  border-bottom: 1px solid var(--border-color);
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  position: sticky;
  top: 0;
  z-index: 10;
}

.status-tabs::-webkit-scrollbar {
  display: none;
}

.tab-item {
  flex-shrink: 0;
  padding: 14px 16px;
  font-size: 14px;
  color: var(--text-secondary);
  cursor: pointer;
  position: relative;
  transition: color 0.2s;
  white-space: nowrap;
}

.tab-item.active {
  color: var(--primary-color);
  font-weight: 500;
}

.tab-item.active::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 24px;
  height: 2px;
  background: var(--primary-color);
  border-radius: 1px;
}

/* Order List */
.order-list {
  padding: 12px;
}

/* Order Card */
.order-card {
  background: var(--bg-white);
  border-radius: 8px;
  margin-bottom: 12px;
  overflow: hidden;
}

.order-card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px;
  border-bottom: 1px solid var(--border-color);
}

.order-no {
  font-size: 12px;
  color: var(--text-placeholder);
  font-family: monospace;
}

.order-status {
  font-size: 13px;
  font-weight: 500;
}

.order-status.pending { color: var(--warning-color); }
.order-status.paid { color: var(--primary-color); }
.order-status.accepted { color: var(--primary-color); }
.order-status.departing { color: #3b82f6; }
.order-status.serving { color: #8b5cf6; }
.order-status.completed { color: var(--text-placeholder); }
.order-status.cancelled { color: var(--text-placeholder); }
.order-status.refunded { color: var(--danger-color); }

.order-card-body {
  padding: 12px;
}

.order-service {
  display: flex;
  align-items: center;
  margin-bottom: 12px;
}

.service-icon {
  width: 48px;
  height: 48px;
  border-radius: 8px;
  background: var(--primary-light);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  margin-right: 12px;
}

.service-info {
  flex: 1;
}

.service-name {
  font-size: 15px;
  font-weight: 500;
  color: var(--text-primary);
  margin-bottom: 4px;
}

.service-tech {
  font-size: 13px;
  color: var(--text-secondary);
}

.service-price {
  font-size: 16px;
  font-weight: 600;
  color: var(--danger-color);
}

.service-price::before {
  content: 'Â¥';
  font-size: 12px;
}

.order-detail-row {
  display: flex;
  align-items: flex-start;
  font-size: 13px;
  color: var(--text-secondary);
  margin-bottom: 8px;
}

.order-detail-row:last-child {
  margin-bottom: 0;
}

.detail-icon {
  margin-right: 6px;
  flex-shrink: 0;
}

.detail-text {
  flex: 1;
  line-height: 1.4;
}

.order-card-footer {
  display: flex;
  justify-content: flex-end;
  align-items: center;
  padding: 12px;
  border-top: 1px solid var(--border-color);
  gap: 12px;
}

.order-card-footer .btn {
  padding: 8px 16px;
  font-size: 13px;
  border-radius: 16px;
}

/* Empty State */
.empty-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 60px 20px;
}

.empty-icon {
  font-size: 64px;
  margin-bottom: 16px;
}

.empty-text {
  font-size: 15px;
  color: var(--text-placeholder);
  margin-bottom: 24px;
}

.empty-state .btn {
  padding: 10px 24px;
  border-radius: 20px;
}
</style>

<script>
(function() {
  // è®¢å•çŠ¶æ€æ˜ å°„
  const STATUS_MAP = {
    0: { text: 'å¾…æ”¯ä»˜', class: 'pending' },
    1: { text: 'å¾…æ¥å•', class: 'paid' },
    2: { text: 'å¾…æœåŠ¡', class: 'accepted' },
    3: { text: 'æŠ€å¸ˆå‡ºå‘ä¸­', class: 'departing' },
    4: { text: 'æœåŠ¡ä¸­', class: 'serving' },
    5: { text: 'å·²å®Œæˆ', class: 'completed' },
    6: { text: 'å·²å–æ¶ˆ', class: 'cancelled' },
    7: { text: 'å·²é€€æ¬¾', class: 'refunded' }
  };

  // Mock è®¢å•æ•°æ®
  const mockOrders = [
    {
      orderNo: 'QY20260111143000A1B2',
      status: 5,
      serviceName: 'å…¨èº«ä¸­å¼æ¨æ‹¿',
      serviceIcon: 'ğŸ’†',
      techName: 'å¼ å¸ˆå‚…',
      price: 298,
      scheduleDate: '2026-01-10',
      scheduleTime: '14:00',
      address: 'åŒ—äº¬å¸‚æœé˜³åŒºå»ºå›½è·¯88å·SOHOç°ä»£åŸAåº§1201',
      createTime: '2026-01-10 13:30:00',
      hasReview: true
    },
    {
      orderNo: 'QY20260111150000C3D4',
      status: 4,
      serviceName: 'è‚©é¢ˆæ·±åº¦è°ƒç†',
      serviceIcon: 'ğŸ’ª',
      techName: 'æå¸ˆå‚…',
      price: 198,
      scheduleDate: '2026-01-11',
      scheduleTime: '15:00',
      address: 'åŒ—äº¬å¸‚æµ·æ·€åŒºä¸­å…³æ‘å¤§è¡—1å·',
      createTime: '2026-01-11 14:30:00',
      hasReview: false
    },
    {
      orderNo: 'QY20260111160000E5F6',
      status: 2,
      serviceName: 'ç²¾æ²¹é¦™è–°SPA',
      serviceIcon: 'ğŸŒ¸',
      techName: 'ç‹å¸ˆå‚…',
      price: 458,
      scheduleDate: '2026-01-12',
      scheduleTime: '16:00',
      address: 'åŒ—äº¬å¸‚è¥¿åŸåŒºé‡‘èè¡—8å·',
      createTime: '2026-01-11 15:00:00',
      hasReview: false
    },
    {
      orderNo: 'QY20260111170000G7H8',
      status: 0,
      serviceName: 'æ³°å¼å¤æ³•æŒ‰æ‘©',
      serviceIcon: 'ğŸ§˜',
      techName: 'èµµå¸ˆå‚…',
      price: 398,
      scheduleDate: '2026-01-13',
      scheduleTime: '17:00',
      address: 'åŒ—äº¬å¸‚ä¸œåŸåŒºç‹åºœäº•å¤§è¡—1å·',
      createTime: '2026-01-11 16:00:00',
      hasReview: false
    },
    {
      orderNo: 'QY20260111180000I9J0',
      status: 6,
      serviceName: 'èƒŒéƒ¨æ¨æ‹¿æ”¾æ¾',
      serviceIcon: 'ğŸ§˜',
      techName: 'å­™å¸ˆå‚…',
      price: 218,
      scheduleDate: '2026-01-09',
      scheduleTime: '18:00',
      address: 'åŒ—äº¬å¸‚ä¸°å°åŒºä¸½æ³½å•†åŠ¡åŒº',
      createTime: '2026-01-09 17:00:00',
      cancelReason: 'ç”¨æˆ·å–æ¶ˆ',
      hasReview: false
    }
  ];

  let currentStatus = 'all';
  let orders = [...mockOrders];

  // åˆ‡æ¢æ ‡ç­¾
  window.switchTab = function(status, element) {
    // æ›´æ–°æ ‡ç­¾çŠ¶æ€
    document.querySelectorAll('.tab-item').forEach(tab => tab.classList.remove('active'));
    element.classList.add('active');
    
    currentStatus = status;
    renderOrders();
  };

  // ç­›é€‰è®¢å•
  function filterOrders() {
    if (currentStatus === 'all') {
      return orders;
    }
    
    const statusList = currentStatus.split(',').map(Number);
    return orders.filter(order => statusList.includes(order.status));
  }

  // æ¸²æŸ“è®¢å•åˆ—è¡¨
  function renderOrders() {
    const filtered = filterOrders();
    const container = document.getElementById('orderList');
    const emptyState = document.getElementById('emptyState');
    
    if (filtered.length === 0) {
      container.innerHTML = '';
      emptyState.style.display = 'flex';
      return;
    }
    
    emptyState.style.display = 'none';
    
    container.innerHTML = filtered.map(order => {
      const status = STATUS_MAP[order.status];
      const actions = getOrderActions(order);
      
      return `
        <div class="order-card" onclick="viewOrderDetail('${order.orderNo}')">
          <div class="order-card-header">
            <span class="order-no">${order.orderNo}</span>
            <span class="order-status ${status.class}">${status.text}</span>
          </div>
          <div class="order-card-body">
            <div class="order-service">
              <div class="service-icon">${order.serviceIcon}</div>
              <div class="service-info">
                <div class="service-name">${order.serviceName}</div>
                <div class="service-tech">æŠ€å¸ˆï¼š${order.techName}</div>
              </div>
              <div class="service-price">${order.price}</div>
            </div>
            <div class="order-detail-row">
              <span class="detail-icon">ğŸ“…</span>
              <span class="detail-text">${formatDateTime(order.scheduleDate, order.scheduleTime)}</span>
            </div>
            <div class="order-detail-row">
              <span class="detail-icon">ğŸ“</span>
              <span class="detail-text">${order.address}</span>
            </div>
          </div>
          ${actions.length > 0 ? `
            <div class="order-card-footer" onclick="event.stopPropagation()">
              ${actions.map(action => `
                <button class="btn ${action.primary ? 'btn-primary' : 'btn-secondary'}" 
                        onclick="${action.handler}">
                  ${action.text}
                </button>
              `).join('')}
            </div>
          ` : ''}
        </div>
      `;
    }).join('');
  }

  // è·å–è®¢å•æ“ä½œæŒ‰é’®
  function getOrderActions(order) {
    const actions = [];
    
    switch (order.status) {
      case 0: // å¾…æ”¯ä»˜
        actions.push({ text: 'å–æ¶ˆè®¢å•', handler: `cancelOrder('${order.orderNo}')`, primary: false });
        actions.push({ text: 'å»æ”¯ä»˜', handler: `payOrder('${order.orderNo}')`, primary: true });
        break;
      case 1: // å¾…æ¥å•
      case 2: // å¾…æœåŠ¡
        actions.push({ text: 'å–æ¶ˆè®¢å•', handler: `cancelOrder('${order.orderNo}')`, primary: false });
        actions.push({ text: 'è”ç³»æŠ€å¸ˆ', handler: `contactTech('${order.orderNo}')`, primary: true });
        break;
      case 3: // æŠ€å¸ˆå‡ºå‘ä¸­
      case 4: // æœåŠ¡ä¸­
        actions.push({ text: 'è”ç³»æŠ€å¸ˆ', handler: `contactTech('${order.orderNo}')`, primary: true });
        break;
      case 5: // å·²å®Œæˆ
        if (!order.hasReview) {
          actions.push({ text: 'å»è¯„ä»·', handler: `reviewOrder('${order.orderNo}')`, primary: true });
        }
        actions.push({ text: 'å†æ¬¡é¢„çº¦', handler: `rebookOrder('${order.orderNo}')`, primary: false });
        break;
      case 6: // å·²å–æ¶ˆ
      case 7: // å·²é€€æ¬¾
        actions.push({ text: 'å†æ¬¡é¢„çº¦', handler: `rebookOrder('${order.orderNo}')`, primary: true });
        break;
    }
    
    return actions;
  }

  // æ ¼å¼åŒ–æ—¥æœŸæ—¶é—´
  function formatDateTime(date, time) {
    const [year, month, day] = date.split('-');
    const d = new Date(date);
    const dayNames = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'];
    return `${month}æœˆ${day}æ—¥ ${dayNames[d.getDay()]} ${time}`;
  }

  // æŸ¥çœ‹è®¢å•è¯¦æƒ…
  window.viewOrderDetail = function(orderNo) {
    QY.navigateTo('order/detail', { orderNo });
  };

  // å–æ¶ˆè®¢å•
  window.cancelOrder = function(orderNo) {
    if (confirm('ç¡®å®šè¦å–æ¶ˆè®¢å•å—ï¼Ÿ')) {
      const order = orders.find(o => o.orderNo === orderNo);
      if (order) {
        order.status = 6;
        order.cancelReason = 'ç”¨æˆ·å–æ¶ˆ';
        renderOrders();
        QY.showToast('è®¢å•å·²å–æ¶ˆ');
      }
    }
  };

  // å»æ”¯ä»˜
  window.payOrder = function(orderNo) {
    const order = orders.find(o => o.orderNo === orderNo);
    if (order) {
      sessionStorage.setItem('currentOrder', JSON.stringify(order));
      QY.navigateTo('order/pay', { orderNo });
    }
  };

  // è”ç³»æŠ€å¸ˆ
  window.contactTech = function(orderNo) {
    QY.showToast('æ­£åœ¨å‘¼å«æŠ€å¸ˆ...');
  };

  // å»è¯„ä»·
  window.reviewOrder = function(orderNo) {
    QY.navigateTo('order/detail', { orderNo, action: 'review' });
  };

  // å†æ¬¡é¢„çº¦
  window.rebookOrder = function(orderNo) {
    const order = orders.find(o => o.orderNo === orderNo);
    if (order) {
      QY.navigateTo('technician/detail', { id: 1 }); // ç®€åŒ–å¤„ç†
    }
  };

  // åˆå§‹åŒ–
  renderOrders();

})();
</script>
