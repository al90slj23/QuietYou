# 04.quality-04.size - 文件大小与拆分规范

> **文档版本**：v1.0.0
> **创建日期**：2026-01-13

---

## 📍 文档定位

本文档定义**代码文件行数控制与拆分策略**。核心目标是保证代码易于理解、便于维护，特别是在 AI 辅助开发场景下避免"巨石文件"导致上下文混乱。

---

## 🎯 核心理念

### 为什么要控制文件大小

1. **AI 友好**：AI 容易读懂、容易全局修改
2. **避免混乱**：巨石文件导致上下文切割混乱
3. **便于维护**：方便后期人类接手维护与重构

---

## 📏 行数标准

### 单文件行数（不含空行与注释）

| 级别 | 行数 | 说明 |
|------|------|------|
| 推荐 | 300-500 | 最佳实践 |
| 允许上限 | 700 | 可接受 |
| 强制重构 | >800 | 必须拆分 |
| 规范违规 | >1200 | 禁止继续新增，必须先重构 |

### 按文件类型细化

| 文件类型 | 目标行数 | 上限 |
|---------|---------|------|
| Vue 组件 | 200-400 | 600 |
| PHP API | 200-400 | 600 |
| 工具函数 | 200-400 | 600 |
| 样式文件 | 200-400 | 600 |
| 配置文件 | - | 400 |

---

## 📐 函数粒度规范

### 函数行数标准

| 类型 | 推荐 | 上限 | 说明 |
|------|------|------|------|
| 普通函数/方法 | 10-40 | 80 | 超过需拆分 |
| 复杂业务流程 | 40-80 | 120 | 允许但需谨慎 |

### 超过 80 行时的拆分建议

应拆分为子函数：
- `validateXxx()` - 验证逻辑
- `buildXxxPayload()` - 构建数据
- `applyXxxRule()` - 应用规则

---

## 🔧 Vue 组件拆分策略

### 页面级拆分结构

```
PageName/
├── index.vue              # 入口（设备检测，20-50行）
├── index.pc.vue           # PC 视图
├── index.mobile.vue       # 移动端视图
│
│   # 当单文件超过 600 行时，拆分为：
├── PageName.logic.js      # 共享逻辑（composable）
├── PageName.style.scss    # 共享样式
│
│   # 子组件
└── components/
    ├── Sidebar.vue        # 侧边栏组件
    ├── Content.vue        # 内容组件
    └── Toolbar.vue        # 工具栏组件
```

### 拆分原则

1. **逻辑抽离**：复杂逻辑抽取到 `composables/` 或同目录 `.logic.js`
2. **样式分离**：超过 200 行样式抽取到独立 `.scss` 文件
3. **子组件拆分**：可复用或独立功能块拆为子组件

### 示例：Whitepaper 组件拆分

```
Whitepaper/
├── index.vue              # 入口
├── index.pc.vue           # PC 主视图（≤400行）
├── index.mobile.vue       # 移动端主视图（≤400行）
├── Whitepaper.logic.js    # 共享逻辑（composable）
├── Whitepaper.style.scss  # 共享样式变量
└── components/
    ├── Sidebar.vue        # 侧边栏导航
    ├── MindmapRenderer.vue # 思维导图渲染器
    └── TableOfContents.vue # 目录组件
```

---

## 🚨 强制规则

### 创建新文件时

预估将产生大量逻辑时，应主动拆分为多个文件。

### 增量修改时

若当前文件已接近 600 行，不应继续堆积逻辑：
- 抽出新模块/子组件
- 把通用逻辑提取到 composables

### 检测超限时

当发现文件行数 > 800 行：
- 必须先输出重构计划（文件拆分方案）
- 再继续开发

### 禁止行为

- ❌ 禁止新建任何 > 700 行的"第一次提交"文件
- ❌ 禁止在"已超 800 行"的文件上继续新增业务逻辑

---

## ✅ 检查清单

- [ ] 单文件行数 ≤ 700
- [ ] 单函数行数 ≤ 80
- [ ] 复杂业务函数 ≤ 120
- [ ] 超限文件有重构计划
- [ ] 视图/逻辑/样式分离

---

**最后更新**：2026-01-13
