# 轻养到家 - 功能实现计划书

> 基于产品愿景和技师体系设计，规划 user/tech/merchant 三端功能实现

## 核心理念回顾

**平台定位**：多元化链接平台，连接商家、技师、顾客三方
**核心价值**：永远的第三方，兜住所有剩余资源
**盈利模式**：订单服务费（从美团/抖音分流），供应链增值服务

---

## 一、用户端 `/user`

### 1.1 现有功能（需优化）

| 模块 | 路由 | 状态 | 说明 |
|------|------|------|------|
| 首页 | `/user/home` | ✅ 已有 | 需优化展示逻辑 |
| 服务列表 | `/user/service/list` | ✅ 已有 | 需完善筛选 |
| 服务详情 | `/user/service/detail/:id` | ✅ 已有 | 需完善 |
| 技师列表 | `/user/technician/list` | ✅ 已有 | 需增加筛选维度 |
| 技师详情 | `/user/technician/detail/:id` | ✅ 已有 | 需展示评价体系 |
| 订单列表 | `/user/order/list` | ✅ 已有 | 需完善状态流转 |
| 订单详情 | `/user/order/detail/:id` | ✅ 已有 | 需完善 |
| 创建订单 | `/user/order/create` | ✅ 已有 | 需完善 |
| 确认订单 | `/user/order/confirm` | ✅ 已有 | 需完善 |
| 支付订单 | `/user/order/pay/:id` | ✅ 已有 | 需完善 |
| 个人中心 | `/user/profile` | ✅ 已有 | 需完善 |

### 1.2 新增功能

| 模块 | 路由 | 优先级 | 说明 |
|------|------|--------|------|
| 附近店铺 | `/user/shop/list` | P1 | 支持到店消费引流 |
| 店铺详情 | `/user/shop/detail/:id` | P1 | 店铺信息、技师列表、服务项目 |
| 评价技师 | `/user/order/review/:id` | P1 | 多维度评分（手法、态度、准时、沟通、卫生） |
| 收藏技师 | `/user/favorite/technician` | P2 | 常用技师快速预约 |
| 收藏店铺 | `/user/favorite/shop` | P2 | 常去店铺 |
| 优惠券 | `/user/coupon/list` | P2 | 平台让利机制 |
| 地址管理 | `/user/address/list` | P1 | 上门服务地址 |
| 消息通知 | `/user/message/list` | P2 | 订单状态、优惠推送 |

### 1.3 用户端核心流程

```
首页
  ├── 选择服务类型
  │     ├── 上门服务 → 选技师 → 选时间地址 → 下单支付
  │     └── 到店服务 → 选店铺 → 选技师 → 选时间 → 下单支付
  ├── 直接选技师
  │     └── 查看详情 → 选服务 → 下单
  └── 选择店铺
        └── 查看店铺 → 选技师/服务 → 下单
```

---

## 二、技师端 `/tech`

### 2.1 技师分类

| 类型 | 注册方式 | 归属 | 收益结算 |
|------|----------|------|----------|
| 店铺技师 | 店铺注册 | 归属店铺 | 结算到店铺账户 |
| 散技师（独立技师） | 个人注册 | 无归属 | 结算到个人账户 |

### 2.2 功能规划

| 模块 | 路由 | 优先级 | 说明 |
|------|------|--------|------|
| 首页/工作台 | `/tech/home` | P0 | 今日订单、收入统计、待处理事项 |
| 订单列表 | `/tech/order/list` | P0 | 待接单、进行中、已完成 |
| 订单详情 | `/tech/order/detail/:id` | P0 | 订单信息、顾客信息、导航 |
| 接单设置 | `/tech/setting/accept` | P1 | 接单开关、服务范围、可用时间 |
| 服务项目 | `/tech/service/list` | P1 | 我的服务项目、价格设置 |
| 收入明细 | `/tech/income/list` | P1 | 收入记录、提现 |
| 评价管理 | `/tech/review/list` | P1 | 顾客评价、店铺评价 |
| 个人资料 | `/tech/profile` | P1 | 基本信息、技能证书、照片 |
| 认证申请 | `/tech/certification` | P2 | 申请培训门店认证 |
| 店铺招聘 | `/tech/job/list` | P2 | 浏览店铺招聘信息 |
| 消息通知 | `/tech/message/list` | P2 | 新订单、评价、系统通知 |

### 2.3 技师端核心流程

```
工作台
  ├── 新订单提醒 → 查看详情 → 接单/拒单
  ├── 进行中订单 → 开始服务 → 完成服务
  ├── 收入管理 → 查看明细 → 申请提现
  └── 找工作 → 浏览招聘 → 申请/联系
```

### 2.4 技师状态流转

```
离线 ←→ 在线空闲 → 服务中 → 在线空闲
                ↓
            休息中（手动设置）
```

---

## 三、商户端 `/merchant`

### 3.1 功能规划

| 模块 | 路由 | 优先级 | 说明 |
|------|------|--------|------|
| 首页/工作台 | `/merchant/home` | P0 | 今日数据、待处理事项、快捷操作 |
| 订单管理 | `/merchant/order/list` | P0 | 店内订单、外派订单 |
| 订单详情 | `/merchant/order/detail/:id` | P0 | 订单信息、指派技师 |
| 技师管理 | `/merchant/technician/list` | P0 | 店内技师列表 |
| 技师详情 | `/merchant/technician/detail/:id` | P1 | 技师信息、排班、业绩 |
| 添加技师 | `/merchant/technician/add` | P1 | 注册店铺技师 |
| 技师排班 | `/merchant/schedule` | P1 | 技师排班表 |
| 服务项目 | `/merchant/service/list` | P1 | 店铺服务项目管理 |
| 收入统计 | `/merchant/income` | P1 | 收入明细、结算记录 |
| 技师池 | `/merchant/pool/list` | P2 | 浏览平台技师、借调 |
| 借调记录 | `/merchant/pool/borrow` | P2 | 借调技师记录 |
| 发布招聘 | `/merchant/job/list` | P2 | 发布招聘需求 |
| 店铺设置 | `/merchant/setting` | P1 | 店铺信息、营业时间 |
| 采购商城 | `/merchant/supply` | P3 | 消耗品采购 |
| 消息通知 | `/merchant/message/list` | P2 | 新订单、技师申请 |

### 3.2 商户端核心流程

```
工作台
  ├── 新订单 → 查看详情 → 指派技师 → 跟踪服务
  ├── 技师管理 → 添加/编辑技师 → 排班设置
  ├── 缺人时 → 技师池 → 筛选技师 → 发起借调
  ├── 招人时 → 发布招聘 → 查看申请 → 联系/录用
  └── 采购 → 浏览商品 → 下单
```

### 3.3 订单类型

| 类型 | 说明 | 收益归属 |
|------|------|----------|
| 到店订单 | 顾客到店消费 | 店铺 |
| 外派订单（本店技师） | 店内技师上门服务 | 店铺 |
| 借调订单（借入） | 借其他店技师到本店 | 本店付费给对方店铺 |
| 借调订单（借出） | 本店技师去其他店 | 对方店铺付费给本店 |

---

## 四、数据库设计要点

### 4.1 核心表

| 表名 | 说明 |
|------|------|
| `qy_user` | 用户（顾客） |
| `qy_technician` | 技师 |
| `qy_merchant` | 商户/店铺 |
| `qy_service` | 服务项目 |
| `qy_order` | 订单 |
| `qy_review` | 评价 |
| `qy_income` | 收入记录 |
| `qy_settlement` | 结算记录 |

### 4.2 关键字段设计

**技师表关键字段：**
- `type`: 类型（店铺技师/散技师）
- `merchant_id`: 归属店铺（散技师为空）
- `is_certified`: 是否认证
- `status`: 状态（在线/离线/服务中/休息）

**订单表关键字段：**
- `type`: 类型（上门/到店/借调）
- `merchant_id`: 店铺ID
- `technician_id`: 技师ID
- `source_merchant_id`: 技师来源店铺（借调时）
- `status`: 状态流转

---

## 五、实现优先级

### Phase 1：核心流程（P0）
1. 用户端：服务预约、技师选择、订单支付、评价
2. 技师端：接单、服务、收入查看
3. 商户端：订单管理、技师管理

### Phase 2：完善功能（P1）
1. 用户端：店铺列表、地址管理、收藏
2. 技师端：接单设置、服务项目管理、认证
3. 商户端：排班、服务项目、收入统计

### Phase 3：增值功能（P2）
1. 用户端：优惠券、消息通知
2. 技师端：找工作、消息
3. 商户端：技师池借调、招聘发布

### Phase 4：生态功能（P3）
1. 商户端：采购商城
2. 平台：数据分析、运营工具

---

## 六、技术要点

### 6.1 实时通信
- 新订单推送
- 技师状态同步
- 服务进度更新

### 6.2 地理位置
- 附近技师/店铺
- 上门服务导航
- 服务范围设置

### 6.3 支付结算
- 订单支付（微信/支付宝）
- T+N 结算机制
- 技师工资保障（资金留存）

### 6.4 评价体系
- 多维度评分
- 评价可迁移（跟技师走）
- 公开透明

---

## 七、实现进度

### 已完成（2026-01-13）

#### 响应式结构重构
- ✅ 创建 `src/components/common/MobileOnlyTip.vue` - PC端统一提示"请使用移动端访问"
- ✅ 创建 `src/components/common/LoginDialog.vue` - 统一登录弹窗组件（开发阶段随意输入）
- ✅ 重构 User 端入口：`src/views/user/index.vue` + `index.pc.vue` + `index.mobile.vue`
- ✅ 重构 Tech 端入口：`src/views/tech/index.vue` + `index.pc.vue` + `index.mobile.vue`
- ✅ 重构 Merchant 端入口：`src/views/merchant/index.vue` + `index.pc.vue` + `index.mobile.vue`
- ✅ 重构门户入口：`src/views/index.vue` + `index.pc.vue` + `index.mobile.vue`
- ✅ 删除旧 Layout 文件：`UserLayout.vue`、`TechLayout.vue`、`MerchantLayout.vue`
- ✅ 更新路由配置 `src/router/index.js`
- ✅ 修复构建错误：替换不存在的 TDesign 组件（EmptyIcon → InfoCircleIcon, Dropdown → ActionSheet）

#### Bug 修复（2026-01-13 更新）
- ✅ 修复 `src/views/index.vue` - `useMediaQuery` 调用方式错误，从 `useMediaQuery('(max-width: 768px)')` 改为 `const { isMobile } = useMediaQuery()`
- ✅ 修复 `src/components/common/LoginDialog.vue` - TDesign Mobile Vue Popup 组件用法：
  - 将 `v-model="visible"` 改为 `:visible="visible" @visible-change="onVisibleChange"`
  - 添加 `onVisibleChange` 方法处理弹窗关闭事件
  - 修复关闭按钮和登录成功后的关闭逻辑
- ✅ 修复 `src/views/index.mobile.vue` - 入驻选择弹窗：
  - 导入 `Popup as TPopup` 组件
  - 将 `v-model="showJoinPopup"` 改为 `:visible="showJoinPopup" @visible-change="showJoinPopup = $event"`
  - 添加 `:close-on-overlay-click="true"` 支持点击外部关闭

#### 数据库
- ✅ 更新 `qy_technician_list` 表：添加技师类型、认证状态、接单设置、服务范围、回头率等字段
- ✅ 更新 `qy_order_list` 表：添加订单类型（上门/到店/借调）、来源店铺ID
- ✅ 更新 `qy_review_list` 表：添加多维度评分（手法、态度、准时、沟通、卫生）
- ✅ 新增 `qy_borrow_list` 表：技师借调记录
- ✅ 新增 `qy_job_list` 表：店铺招聘信息
- ✅ 新增 `qy_job_apply_list` 表：招聘申请记录
- ✅ 新增 `qy_user_favorite_list` 表：用户收藏
- ✅ 新增 `qy_coupon_list` 表：优惠券
- ✅ 新增 `qy_user_coupon_list` 表：用户优惠券
- ✅ 新增 `qy_message_list` 表：消息通知

#### 技师端 `/tech`
- ✅ `TechLayout.vue` - 底部导航（工作台、订单、收入、我的）
- ✅ `/tech/home` - 工作台（今日数据、快捷操作、待处理订单）
- ✅ `/tech/order/list` - 订单列表（标签页筛选）
- ✅ `/tech/order/detail/:id` - 订单详情
- ✅ `/tech/income` - 收入明细
- ✅ `/tech/income/withdraw` - 申请提现
- ✅ `/tech/service/list` - 服务项目管理
- ✅ `/tech/review/list` - 我的评价（多维度评分展示）
- ✅ `/tech/setting/accept` - 接单设置（服务范围、工作时间、订单偏好）
- ✅ `/tech/job/list` - 店铺招聘浏览
- ✅ `/tech/profile` - 个人中心
- ✅ `/tech/profile/edit` - 编辑资料
- ✅ `/tech/certification` - 认证申请

#### 商户端 `/merchant`
- ✅ `MerchantLayout.vue` - 底部导航（工作台、订单、技师、我的）
- ✅ `/merchant/home` - 工作台（今日数据、待处理、近期订单）
- ✅ `/merchant/order/list` - 订单管理
- ✅ `/merchant/order/detail/:id` - 订单详情
- ✅ `/merchant/tech/list` - 技师管理
- ✅ `/merchant/tech/add` - 添加技师（手机号/二维码邀请）
- ✅ `/merchant/tech/borrow` - 借调技师（筛选、申请）
- ✅ `/merchant/service/list` - 服务项目管理
- ✅ `/merchant/service/edit/:id?` - 编辑服务
- ✅ `/merchant/income` - 收入明细
- ✅ `/merchant/income/withdraw` - 申请提现
- ✅ `/merchant/job/list` - 招聘管理
- ✅ `/merchant/job/edit/:id?` - 编辑招聘
- ✅ `/merchant/profile` - 我的（店铺信息）
- ✅ `/merchant/profile/edit` - 编辑店铺信息
- ✅ `/merchant/setting` - 店铺设置

### 待完成

#### 用户端增强
- ✅ `/user/shop/list` - 附近店铺
- ✅ `/user/shop/detail/:id` - 店铺详情
- ✅ `/user/order/review/:id` - 评价技师（多维度评分）
- ✅ `/user/favorite/list` - 收藏列表
- ✅ `/user/coupon/list` - 优惠券
- ✅ `/user/address/list` - 地址管理
- ✅ `/user/address/edit/:id?` - 编辑地址
- ✅ `/user/message/list` - 消息通知
- ✅ `/user/profile` - 个人中心（已优化）
- ✅ `/user/profile/edit` - 编辑资料

#### PHP API - 技师端（已完成 2026-01-13）
- ✅ `api/tech/auth/login.api.php` - 技师登录
- ✅ `api/tech/auth/info.api.php` - 获取技师信息
- ✅ `api/tech/home/stats.api.php` - 工作台统计
- ✅ `api/tech/order/list.api.php` - 订单列表
- ✅ `api/tech/order/detail.api.php` - 订单详情
- ✅ `api/tech/order/accept.api.php` - 接单
- ✅ `api/tech/order/start.api.php` - 开始服务
- ✅ `api/tech/order/complete.api.php` - 完成服务
- ✅ `api/tech/income/list.api.php` - 收入明细
- ✅ `api/tech/income/withdraw.api.php` - 申请提现
- ✅ `api/tech/service/list.api.php` - 服务项目列表
- ✅ `api/tech/service/update.api.php` - 更新服务项目
- ✅ `api/tech/review/list.api.php` - 评价列表
- ✅ `api/tech/review/reply.api.php` - 回复评价
- ✅ `api/tech/setting/info.api.php` - 获取接单设置
- ✅ `api/tech/setting/update.api.php` - 更新接单设置
- ✅ `api/tech/profile/info.api.php` - 获取个人资料
- ✅ `api/tech/profile/update.api.php` - 更新个人资料
- ✅ `api/tech/certification/info.api.php` - 获取认证状态
- ✅ `api/tech/certification/apply.api.php` - 申请认证
- ✅ `api/tech/job/list.api.php` - 招聘列表
- ✅ `api/tech/job/apply.api.php` - 申请职位

#### PHP API - 商户端（已完成 2026-01-13）
- ✅ `api/merchant/auth/login.api.php` - 商户登录
- ✅ `api/merchant/auth/info.api.php` - 获取商户信息
- ✅ `api/merchant/home/stats.api.php` - 工作台统计
- ✅ `api/merchant/order/list.api.php` - 订单列表
- ✅ `api/merchant/order/detail.api.php` - 订单详情
- ✅ `api/merchant/order/assign.api.php` - 指派技师
- ✅ `api/merchant/tech/list.api.php` - 技师列表
- ✅ `api/merchant/tech/add.api.php` - 添加技师
- ✅ `api/merchant/tech/remove.api.php` - 移除技师
- ✅ `api/merchant/tech/pool.api.php` - 技师池（可借调）
- ✅ `api/merchant/tech/borrow.api.php` - 借调技师
- ✅ `api/merchant/service/list.api.php` - 服务项目列表
- ✅ `api/merchant/income/list.api.php` - 收入明细
- ✅ `api/merchant/income/withdraw.api.php` - 申请提现
- ✅ `api/merchant/job/list.api.php` - 招聘列表
- ✅ `api/merchant/job/save.api.php` - 保存招聘
- ✅ `api/merchant/job/apply/list.api.php` - 申请列表
- ✅ `api/merchant/job/apply/handle.api.php` - 处理申请
- ✅ `api/merchant/profile/update.api.php` - 更新店铺信息

#### PHP API - 用户端增强（已完成 2026-01-13）
- ✅ `api/user/shop/list.api.php` - 附近店铺列表
- ✅ `api/user/shop/detail.api.php` - 店铺详情
- ✅ `api/user/favorite/list.api.php` - 收藏列表
- ✅ `api/user/favorite/toggle.api.php` - 收藏/取消收藏
- ✅ `api/user/coupon/list.api.php` - 优惠券列表
- ✅ `api/user/address/list.api.php` - 地址列表
- ✅ `api/user/address/save.api.php` - 保存地址
- ✅ `api/user/address/delete.api.php` - 删除地址
- ✅ `api/user/message/list.api.php` - 消息列表
- ✅ `api/user/message/read.api.php` - 标记已读
- ✅ `api/user/profile/info.api.php` - 获取个人资料
- ✅ `api/user/profile/update.api.php` - 更新个人资料
- ✅ `api/user/review/submit.api.php` - 提交评价（多维度）

#### 数据库迁移
- ✅ `sql/migration_add_auth_token.sql` - 添加认证 Token 字段

#### 管理后台 `/admin`（待开发）
- [ ] 用户管理
- [ ] 技师管理
- [ ] 商户管理
- [ ] 订单管理
- [ ] 数据统计
